<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>popt: popt.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>popt.c</h1><a href="popt_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00005"></a>00005 <span class="comment">/* (C) 1998-2002 Red Hat, Inc. -- Licensing details are in the COPYING</span>
<a name="l00006"></a>00006 <span class="comment">   file accompanying popt source distributions, available from</span>
<a name="l00007"></a>00007 <span class="comment">   ftp://ftp.rpm.org/pub/rpm/dist */</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#undef  MYDEBUG</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span>
<a name="l00011"></a>00011 <span class="preprocessor">#include "<a class="code" href="system_8h.html">system.h</a>"</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#ifdef HAVE_FLOAT_H</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#endif</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span><span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="findme_8h.html">findme.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "<a class="code" href="poptint_8h.html">poptint.h</a>"</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#ifdef  MYDEBUG</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="comment">/*@unchecked@*/</span>
<a name="l00023"></a>00023 <span class="keywordtype">int</span> _popt_debug = 0;
<a name="l00024"></a>00024 <span class="preprocessor">#endif</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span>
<a name="l00026"></a>00026 <span class="preprocessor">#if !defined(HAVE_STRERROR) &amp;&amp; !defined(__LCLINT__)</span>
<a name="l00027"></a><a class="code" href="popt_8c.html#191b9c878b2a9c6e615ee10082053737">00027</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">char</span> * <a class="code" href="popt_8c.html#191b9c878b2a9c6e615ee10082053737">strerror</a>(<span class="keywordtype">int</span> errno)
<a name="l00028"></a>00028 {
<a name="l00029"></a>00029     <span class="keyword">extern</span> <span class="keywordtype">int</span> sys_nerr;
<a name="l00030"></a>00030     <span class="keyword">extern</span> <span class="keywordtype">char</span> * sys_errlist[];
<a name="l00031"></a>00031 
<a name="l00032"></a>00032     <span class="keywordflow">if</span> ((0 &lt;= errno) &amp;&amp; (errno &lt; sys_nerr))
<a name="l00033"></a>00033         <span class="keywordflow">return</span> sys_errlist[errno];
<a name="l00034"></a>00034     <span class="keywordflow">else</span>
<a name="l00035"></a>00035         <span class="keywordflow">return</span> <a class="code" href="poptint_8h.html#0c20a067634485b9c68ad5dfe83729d2">POPT_</a>(<span class="stringliteral">"unknown errno"</span>);
<a name="l00036"></a>00036 }
<a name="l00037"></a>00037 <span class="preprocessor">#endif</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>
<a name="l00039"></a>00039 <span class="preprocessor">#ifdef MYDEBUG</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="comment">/*@unused@*/</span>
<a name="l00041"></a>00041 <span class="keyword">static</span> <span class="keywordtype">void</span> prtcon(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg, <a class="code" href="structpoptContext__s.html">poptContext</a> con)
<a name="l00042"></a>00042 {
<a name="l00043"></a>00043     <span class="keywordflow">if</span> (msg) fprintf(stderr, <span class="stringliteral">"%s"</span>, msg);
<a name="l00044"></a>00044     fprintf(stderr, <span class="stringliteral">"\tcon %p os %p nextCharArg \"%s\" nextArg \"%s\" argv[%d] \"%s\"\n"</span>,
<a name="l00045"></a>00045         con, con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>,
<a name="l00046"></a>00046         (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a> ? con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a> : <span class="stringliteral">""</span>),
<a name="l00047"></a>00047         (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> ? con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> : <span class="stringliteral">""</span>),
<a name="l00048"></a>00048         con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a>,
<a name="l00049"></a>00049         (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a> &amp;&amp; con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>[con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a>]
<a name="l00050"></a>00050                 ? con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>[con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a>] : <span class="stringliteral">""</span>));
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 <span class="preprocessor">#endif</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span>
<a name="l00054"></a><a class="code" href="popt_8h.html#0f4836b0740d052af6427757c4c72309">00054</a> <span class="keywordtype">void</span> <a class="code" href="popt_8c.html#0f4836b0740d052af6427757c4c72309" title="Limit search for executables.">poptSetExecPath</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con, <span class="keyword">const</span> <span class="keywordtype">char</span> * path, <span class="keywordtype">int</span> allowAbsolute)
<a name="l00055"></a>00055 {
<a name="l00056"></a>00056     con-&gt;<a class="code" href="structpoptContext__s.html#3a8c9082b8dd21f720c24e492519971c">execPath</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(con-&gt;<a class="code" href="structpoptContext__s.html#3a8c9082b8dd21f720c24e492519971c">execPath</a>);
<a name="l00057"></a>00057     con-&gt;<a class="code" href="structpoptContext__s.html#3a8c9082b8dd21f720c24e492519971c">execPath</a> = <a class="code" href="system_8h.html#b62344482c6d93843e0388d2ba2cf514">xstrdup</a>(path);
<a name="l00058"></a>00058     con-&gt;<a class="code" href="structpoptContext__s.html#1c86e964008dc6a755671b412ac6f036">execAbsolute</a> = allowAbsolute;
<a name="l00059"></a>00059 <span class="comment">/*@-nullstate@*/</span> <span class="comment">/* LCL: con-&gt;execPath not NULL */</span>
<a name="l00060"></a>00060     <span class="keywordflow">return</span>;
<a name="l00061"></a>00061 <span class="comment">/*@=nullstate@*/</span>
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="popt_8c.html#a7a7d447dc459030d22b09123ce6bdbf">00064</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="popt_8c.html#a7a7d447dc459030d22b09123ce6bdbf">invokeCallbacksPRE</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structpoptOption.html">poptOption</a> * opt)
<a name="l00065"></a>00065         <span class="comment">/*@globals internalState@*/</span>
<a name="l00066"></a>00066         <span class="comment">/*@modifies internalState@*/</span>
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068     <span class="keywordflow">if</span> (opt != NULL)
<a name="l00069"></a>00069     <span class="keywordflow">for</span> (; opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> || opt-&gt;<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a> || opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>; opt++) {
<a name="l00070"></a>00070         <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a> == NULL) <span class="keywordflow">continue</span>;         <span class="comment">/* XXX program error. */</span>
<a name="l00071"></a>00071         <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#a004e7eeed0d7c6e51d9792fe049bf50">POPT_ARG_INCLUDE_TABLE</a>) {
<a name="l00072"></a>00072             <span class="keywordtype">void</span> * arg = opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>;
<a name="l00073"></a>00073             <span class="comment">/* XXX sick hack to preserve pretense of ABI. */</span>
<a name="l00074"></a>00074             <span class="keywordflow">if</span> (arg == <a class="code" href="popt_8h.html#0c493753b1c5ee878e7addf558874633" title="Auto help table options.">poptHelpOptions</a>) arg = <a class="code" href="popt_8h.html#922c332675c30038924eb94b30b2ded5">poptHelpOptionsI18N</a>;
<a name="l00075"></a>00075             <span class="comment">/* Recurse on included sub-tables. */</span>
<a name="l00076"></a>00076             <a class="code" href="popt_8c.html#a7a7d447dc459030d22b09123ce6bdbf">invokeCallbacksPRE</a>(con, arg);
<a name="l00077"></a>00077         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#d13a93a7e60cf78b2dd0a22db8393ae2">POPT_ARG_CALLBACK</a> &amp;&amp;
<a name="l00078"></a>00078                    (opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#2847a2e98857fa36616ecbe1dbbb6e96">POPT_CBFLAG_PRE</a>))
<a name="l00079"></a>00079         {   <span class="comment">/*@-castfcnptr@*/</span>
<a name="l00080"></a>00080             <a class="code" href="popt_8h.html#f783a37f762ae2234b039141e64e708c" title="Table callback prototype.">poptCallbackType</a> cb = (<a class="code" href="popt_8h.html#f783a37f762ae2234b039141e64e708c" title="Table callback prototype.">poptCallbackType</a>)opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>;
<a name="l00081"></a>00081             <span class="comment">/*@=castfcnptr@*/</span>
<a name="l00082"></a>00082             <span class="comment">/* Perform callback. */</span>
<a name="l00083"></a>00083             <span class="comment">/*@-noeffectuncon @*/</span>
<a name="l00084"></a>00084             cb(con, <a class="code" href="popt_8h.html#fe00605489c2aa204cdb5a14e26b3a704798a7665d4a2294cf3c1275925d07c6">POPT_CALLBACK_REASON_PRE</a>, NULL, NULL, opt-&gt;<a class="code" href="structpoptOption.html#d0123e0f28a19468eb34e89753064745">descrip</a>);
<a name="l00085"></a>00085             <span class="comment">/*@=noeffectuncon @*/</span>
<a name="l00086"></a>00086         }
<a name="l00087"></a>00087     }
<a name="l00088"></a>00088 }
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="popt_8c.html#0b648b607123e3ad9d78843b41a8cc78">00090</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="popt_8c.html#0b648b607123e3ad9d78843b41a8cc78">invokeCallbacksPOST</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structpoptOption.html">poptOption</a> * opt)
<a name="l00091"></a>00091         <span class="comment">/*@globals internalState@*/</span>
<a name="l00092"></a>00092         <span class="comment">/*@modifies internalState@*/</span>
<a name="l00093"></a>00093 {
<a name="l00094"></a>00094     <span class="keywordflow">if</span> (opt != NULL)
<a name="l00095"></a>00095     <span class="keywordflow">for</span> (; opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> || opt-&gt;<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a> || opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>; opt++) {
<a name="l00096"></a>00096         <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a> == NULL) <span class="keywordflow">continue</span>;         <span class="comment">/* XXX program error. */</span>
<a name="l00097"></a>00097         <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#a004e7eeed0d7c6e51d9792fe049bf50">POPT_ARG_INCLUDE_TABLE</a>) {
<a name="l00098"></a>00098             <span class="keywordtype">void</span> * arg = opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>;
<a name="l00099"></a>00099             <span class="comment">/* XXX sick hack to preserve pretense of ABI. */</span>
<a name="l00100"></a>00100             <span class="keywordflow">if</span> (arg == <a class="code" href="popt_8h.html#0c493753b1c5ee878e7addf558874633" title="Auto help table options.">poptHelpOptions</a>) arg = <a class="code" href="popt_8h.html#922c332675c30038924eb94b30b2ded5">poptHelpOptionsI18N</a>;
<a name="l00101"></a>00101             <span class="comment">/* Recurse on included sub-tables. */</span>
<a name="l00102"></a>00102             <a class="code" href="popt_8c.html#0b648b607123e3ad9d78843b41a8cc78">invokeCallbacksPOST</a>(con, arg);
<a name="l00103"></a>00103         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#d13a93a7e60cf78b2dd0a22db8393ae2">POPT_ARG_CALLBACK</a> &amp;&amp;
<a name="l00104"></a>00104                    (opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#367256b21ad9f66c4b83e9311af2399b">POPT_CBFLAG_POST</a>))
<a name="l00105"></a>00105         {   <span class="comment">/*@-castfcnptr@*/</span>
<a name="l00106"></a>00106             <a class="code" href="popt_8h.html#f783a37f762ae2234b039141e64e708c" title="Table callback prototype.">poptCallbackType</a> cb = (<a class="code" href="popt_8h.html#f783a37f762ae2234b039141e64e708c" title="Table callback prototype.">poptCallbackType</a>)opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>;
<a name="l00107"></a>00107             <span class="comment">/*@=castfcnptr@*/</span>
<a name="l00108"></a>00108             <span class="comment">/* Perform callback. */</span>
<a name="l00109"></a>00109             <span class="comment">/*@-noeffectuncon @*/</span>
<a name="l00110"></a>00110             cb(con, <a class="code" href="popt_8h.html#fe00605489c2aa204cdb5a14e26b3a70544a7f11816d2ddeb6d480a9065f2cd2">POPT_CALLBACK_REASON_POST</a>, NULL, NULL, opt-&gt;<a class="code" href="structpoptOption.html#d0123e0f28a19468eb34e89753064745">descrip</a>);
<a name="l00111"></a>00111             <span class="comment">/*@=noeffectuncon @*/</span>
<a name="l00112"></a>00112         }
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a><a class="code" href="popt_8c.html#635149a20667bb61c5ef14a5a567d9ec">00116</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="popt_8c.html#635149a20667bb61c5ef14a5a567d9ec">invokeCallbacksOPTION</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con,
<a name="l00117"></a>00117                                   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structpoptOption.html">poptOption</a> * opt,
<a name="l00118"></a>00118                                   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structpoptOption.html">poptOption</a> * myOpt,
<a name="l00119"></a>00119                                   <span class="comment">/*@null@*/</span> <span class="keyword">const</span> <span class="keywordtype">void</span> * myData, <span class="keywordtype">int</span> shorty)
<a name="l00120"></a>00120         <span class="comment">/*@globals internalState@*/</span>
<a name="l00121"></a>00121         <span class="comment">/*@modifies internalState@*/</span>
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123     <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpoptOption.html">poptOption</a> * cbopt = NULL;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <span class="keywordflow">if</span> (opt != NULL)
<a name="l00126"></a>00126     <span class="keywordflow">for</span> (; opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> || opt-&gt;<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a> || opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>; opt++) {
<a name="l00127"></a>00127         <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#a004e7eeed0d7c6e51d9792fe049bf50">POPT_ARG_INCLUDE_TABLE</a>) {
<a name="l00128"></a>00128             <span class="keywordtype">void</span> * <a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a> = opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>;
<a name="l00129"></a>00129             <span class="comment">/* XXX sick hack to preserve pretense of ABI. */</span>
<a name="l00130"></a>00130             <span class="keywordflow">if</span> (arg == <a class="code" href="popt_8h.html#0c493753b1c5ee878e7addf558874633" title="Auto help table options.">poptHelpOptions</a>) arg = <a class="code" href="popt_8h.html#922c332675c30038924eb94b30b2ded5">poptHelpOptionsI18N</a>;
<a name="l00131"></a>00131             <span class="comment">/* Recurse on included sub-tables. */</span>
<a name="l00132"></a>00132             <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a> != NULL)       <span class="comment">/* XXX program error */</span>
<a name="l00133"></a>00133                 <a class="code" href="popt_8c.html#635149a20667bb61c5ef14a5a567d9ec">invokeCallbacksOPTION</a>(con, opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>, myOpt, myData, shorty);
<a name="l00134"></a>00134         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#d13a93a7e60cf78b2dd0a22db8393ae2">POPT_ARG_CALLBACK</a> &amp;&amp;
<a name="l00135"></a>00135                   !(opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#108a81171f9d28066e8b3c55d5d297ac">POPT_CBFLAG_SKIPOPTION</a>)) {
<a name="l00136"></a>00136             <span class="comment">/* Save callback info. */</span>
<a name="l00137"></a>00137             cbopt = opt;
<a name="l00138"></a>00138         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cbopt != NULL &amp;&amp;
<a name="l00139"></a>00139                    ((myOpt-&gt;<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a> &amp;&amp; opt-&gt;<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a> &amp;&amp; shorty &amp;&amp;
<a name="l00140"></a>00140                         myOpt-&gt;<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a> == opt-&gt;<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a>) ||
<a name="l00141"></a>00141                     (myOpt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> != NULL &amp;&amp; opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> != NULL &amp;&amp;
<a name="l00142"></a>00142                         !strcmp(myOpt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>, opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>)))
<a name="l00143"></a>00143                    )
<a name="l00144"></a>00144         {   <span class="comment">/*@-castfcnptr@*/</span>
<a name="l00145"></a>00145             <a class="code" href="popt_8h.html#f783a37f762ae2234b039141e64e708c" title="Table callback prototype.">poptCallbackType</a> cb = (<a class="code" href="popt_8h.html#f783a37f762ae2234b039141e64e708c" title="Table callback prototype.">poptCallbackType</a>)cbopt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>;
<a name="l00146"></a>00146             <span class="comment">/*@=castfcnptr@*/</span>
<a name="l00147"></a>00147             <span class="keyword">const</span> <span class="keywordtype">void</span> * cbData = (cbopt-&gt;<a class="code" href="structpoptOption.html#d0123e0f28a19468eb34e89753064745">descrip</a> ? cbopt-&gt;<a class="code" href="structpoptOption.html#d0123e0f28a19468eb34e89753064745">descrip</a> : myData);
<a name="l00148"></a>00148             <span class="comment">/* Perform callback. */</span>
<a name="l00149"></a>00149             <span class="keywordflow">if</span> (cb != NULL) {   <span class="comment">/* XXX program error */</span>
<a name="l00150"></a>00150                 <span class="comment">/*@-noeffectuncon @*/</span>
<a name="l00151"></a>00151                 cb(con, <a class="code" href="popt_8h.html#fe00605489c2aa204cdb5a14e26b3a704b68221591faaf0a061817f43caa8313">POPT_CALLBACK_REASON_OPTION</a>, myOpt,
<a name="l00152"></a>00152                         con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a>, cbData);
<a name="l00153"></a>00153                 <span class="comment">/*@=noeffectuncon @*/</span>
<a name="l00154"></a>00154             }
<a name="l00155"></a>00155             <span class="comment">/* Terminate (unless explcitly continuing). */</span>
<a name="l00156"></a>00156             <span class="keywordflow">if</span> (!(cbopt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#aa017dd880ece525e864c235f6677c84">POPT_CBFLAG_CONTINUE</a>))
<a name="l00157"></a>00157                 <span class="keywordflow">return</span>;
<a name="l00158"></a>00158         }
<a name="l00159"></a>00159     }
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="popt_8h.html#b50911f0a2d72ccaeaa3d80bc2b911a0">00162</a> <a class="code" href="structpoptContext__s.html">poptContext</a> <a class="code" href="popt_8c.html#b50911f0a2d72ccaeaa3d80bc2b911a0" title="Initialize popt context.">poptGetContext</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * name, <span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> ** argv,
<a name="l00163"></a>00163                            <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structpoptOption.html">poptOption</a> * options, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flags)
<a name="l00164"></a>00164 {
<a name="l00165"></a>00165     <a class="code" href="structpoptContext__s.html">poptContext</a> con = malloc(<span class="keyword">sizeof</span>(*con));
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     <span class="keywordflow">if</span> (con == NULL) <span class="keywordflow">return</span> NULL;       <span class="comment">/* XXX can't happen */</span>
<a name="l00168"></a>00168     memset(con, 0, <span class="keyword">sizeof</span>(*con));
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a> = con-&gt;<a class="code" href="structpoptContext__s.html#fb4fe00e407510f15c15de9bcdcc9a03">optionStack</a>;
<a name="l00171"></a>00171     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a> = argc;
<a name="l00172"></a>00172 <span class="comment">/*@-dependenttrans -assignexpose@*/</span>     <span class="comment">/* FIX: W2DO? */</span>
<a name="l00173"></a>00173     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a> = argv;
<a name="l00174"></a>00174 <span class="comment">/*@=dependenttrans =assignexpose@*/</span>
<a name="l00175"></a>00175     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a> = NULL;
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     <span class="keywordflow">if</span> (!(flags &amp; <a class="code" href="popt_8h.html#06558f38ec0073d21dc32a3cdd1e4077">POPT_CONTEXT_KEEP_FIRST</a>))
<a name="l00178"></a>00178         con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a> = 1;                      <span class="comment">/* skip argv[0] */</span>
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a> = calloc( (argc + 1), <span class="keyword">sizeof</span>(*con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a>) );
<a name="l00181"></a>00181 <span class="comment">/*@-dependenttrans -assignexpose@*/</span>     <span class="comment">/* FIX: W2DO? */</span>
<a name="l00182"></a>00182     con-&gt;<a class="code" href="structpoptContext__s.html#dad9df807e74fca28fae63d26a2f01b2">options</a> = options;
<a name="l00183"></a>00183 <span class="comment">/*@=dependenttrans =assignexpose@*/</span>
<a name="l00184"></a>00184     con-&gt;<a class="code" href="structpoptContext__s.html#03cc608197cd1897d1228aef0d8bf61d">aliases</a> = NULL;
<a name="l00185"></a>00185     con-&gt;<a class="code" href="structpoptContext__s.html#fb0ace2c6600299043a3ec8a922bc820">numAliases</a> = 0;
<a name="l00186"></a>00186     con-&gt;<a class="code" href="structpoptContext__s.html#0d532e7d187d8fd54b9de229ea1a51c4">flags</a> = flags;
<a name="l00187"></a>00187     con-&gt;<a class="code" href="structpoptContext__s.html#17343ec6b740a3ac2066cf8d99488005">execs</a> = NULL;
<a name="l00188"></a>00188     con-&gt;<a class="code" href="structpoptContext__s.html#57cfdc604ad6e3ff739c0d8d3a0e818a">numExecs</a> = 0;
<a name="l00189"></a>00189     con-&gt;<a class="code" href="structpoptContext__s.html#22873bd65778f6f1bfb1d4bc5d827bf4">finalArgvAlloced</a> = argc * 2;
<a name="l00190"></a>00190     con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a> = calloc( con-&gt;<a class="code" href="structpoptContext__s.html#22873bd65778f6f1bfb1d4bc5d827bf4">finalArgvAlloced</a>, <span class="keyword">sizeof</span>(*con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>) );
<a name="l00191"></a>00191     con-&gt;<a class="code" href="structpoptContext__s.html#1c86e964008dc6a755671b412ac6f036">execAbsolute</a> = 1;
<a name="l00192"></a>00192     con-&gt;<a class="code" href="structpoptContext__s.html#6b8f9e4e2175d16b8903243819318418">arg_strip</a> = NULL;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     <span class="keywordflow">if</span> (getenv(<span class="stringliteral">"POSIXLY_CORRECT"</span>) || getenv(<span class="stringliteral">"POSIX_ME_HARDER"</span>))
<a name="l00195"></a>00195         con-&gt;<a class="code" href="structpoptContext__s.html#0d532e7d187d8fd54b9de229ea1a51c4">flags</a> |= <a class="code" href="popt_8h.html#e980ab2ac9b1a95c96adf247edaaf3c0">POPT_CONTEXT_POSIXMEHARDER</a>;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     <span class="keywordflow">if</span> (name) {
<a name="l00198"></a>00198         <span class="keywordtype">char</span> * t = malloc(strlen(name) + 1);
<a name="l00199"></a>00199         <span class="keywordflow">if</span> (t) con-&gt;<a class="code" href="structpoptContext__s.html#afe275efe496fa1217d5d8dff6434aa9">appName</a> = strcpy(t, name);
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="comment">/*@-internalglobs@*/</span>
<a name="l00203"></a>00203     <a class="code" href="popt_8c.html#a7a7d447dc459030d22b09123ce6bdbf">invokeCallbacksPRE</a>(con, con-&gt;<a class="code" href="structpoptContext__s.html#dad9df807e74fca28fae63d26a2f01b2">options</a>);
<a name="l00204"></a>00204 <span class="comment">/*@=internalglobs@*/</span>
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <span class="keywordflow">return</span> con;
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00209"></a><a class="code" href="popt_8c.html#9fdab699d4f5021e1507fecc87a1363f">00209</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="popt_8c.html#9fdab699d4f5021e1507fecc87a1363f">cleanOSE</a>(<span class="comment">/*@special@*/</span> <span class="keyword">struct</span> <a class="code" href="structoptionStackEntry.html">optionStackEntry</a> *os)
<a name="l00210"></a>00210         <span class="comment">/*@uses os @*/</span>
<a name="l00211"></a>00211         <span class="comment">/*@releases os-&gt;nextArg, os-&gt;argv, os-&gt;argb @*/</span>
<a name="l00212"></a>00212         <span class="comment">/*@modifies os @*/</span>
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214     os-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(os-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a>);
<a name="l00215"></a>00215     os-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(os-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>);
<a name="l00216"></a>00216     os-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a> = <a class="code" href="poptint_8h.html#78689d45d1c852a2513fa04271495b0c">PBM_FREE</a>(os-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a>);
<a name="l00217"></a>00217 }
<a name="l00218"></a>00218 
<a name="l00219"></a><a class="code" href="popt_8h.html#66e307ed79a41a4b8880e0b06f04414b">00219</a> <span class="keywordtype">void</span> <a class="code" href="popt_8c.html#66e307ed79a41a4b8880e0b06f04414b" title="Reinitialize popt context.">poptResetContext</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con)
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221     <span class="keywordtype">int</span> i;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <span class="keywordflow">if</span> (con == NULL) <span class="keywordflow">return</span>;
<a name="l00224"></a>00224     <span class="keywordflow">while</span> (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a> &gt; con-&gt;<a class="code" href="structpoptContext__s.html#fb4fe00e407510f15c15de9bcdcc9a03">optionStack</a>) {
<a name="l00225"></a>00225         <a class="code" href="popt_8c.html#9fdab699d4f5021e1507fecc87a1363f">cleanOSE</a>(con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>--);
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a> = <a class="code" href="poptint_8h.html#78689d45d1c852a2513fa04271495b0c">PBM_FREE</a>(con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a>);
<a name="l00228"></a>00228     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#358da17455ddd94a5acd74b0559aa8a5">currAlias</a> = NULL;
<a name="l00229"></a>00229     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a> = NULL;
<a name="l00230"></a>00230     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> = NULL;
<a name="l00231"></a>00231     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a> = 1;                  <span class="comment">/* skip argv[0] */</span>
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     con-&gt;<a class="code" href="structpoptContext__s.html#a7a13994df6f103d61fed3bd5bada6e2">numLeftovers</a> = 0;
<a name="l00234"></a>00234     con-&gt;<a class="code" href="structpoptContext__s.html#217a5349eaed3f52683f2b8fa751e3e0">nextLeftover</a> = 0;
<a name="l00235"></a>00235     con-&gt;<a class="code" href="structpoptContext__s.html#be76dfc76f4a31852dafd07ae0361537">restLeftover</a> = 0;
<a name="l00236"></a>00236     con-&gt;<a class="code" href="structpoptContext__s.html#9359f8ed735796ace78ef225c1eb3ee9">doExec</a> = NULL;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a> != NULL)
<a name="l00239"></a>00239     <span class="keywordflow">for</span> (i = 0; i &lt; con-&gt;<a class="code" href="structpoptContext__s.html#0c5a151e184bf3996af518c7c1a9fdbd">finalArgvCount</a>; i++) {
<a name="l00240"></a>00240 <span class="comment">/*@-unqualifiedtrans@*/</span>         <span class="comment">/* FIX: typedef double indirection. */</span>
<a name="l00241"></a>00241         con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>[i] = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>[i]);
<a name="l00242"></a>00242 <span class="comment">/*@=unqualifiedtrans@*/</span>
<a name="l00243"></a>00243     }
<a name="l00244"></a>00244 
<a name="l00245"></a>00245     con-&gt;<a class="code" href="structpoptContext__s.html#0c5a151e184bf3996af518c7c1a9fdbd">finalArgvCount</a> = 0;
<a name="l00246"></a>00246     con-&gt;<a class="code" href="structpoptContext__s.html#6b8f9e4e2175d16b8903243819318418">arg_strip</a> = <a class="code" href="poptint_8h.html#78689d45d1c852a2513fa04271495b0c">PBM_FREE</a>(con-&gt;<a class="code" href="structpoptContext__s.html#6b8f9e4e2175d16b8903243819318418">arg_strip</a>);
<a name="l00247"></a>00247 <span class="comment">/*@-nullstate@*/</span>        <span class="comment">/* FIX: con-&gt;finalArgv != NULL */</span>
<a name="l00248"></a>00248     <span class="keywordflow">return</span>;
<a name="l00249"></a>00249 <span class="comment">/*@=nullstate@*/</span>
<a name="l00250"></a>00250 }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 <span class="comment">/* Only one of longName, shortName should be set, not both. */</span>
<a name="l00253"></a><a class="code" href="popt_8c.html#44cac0f7730e758ed146538e33cf2226">00253</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="popt_8c.html#44cac0f7730e758ed146538e33cf2226">handleExec</a>(<span class="comment">/*@special@*/</span> <a class="code" href="structpoptContext__s.html">poptContext</a> con,
<a name="l00254"></a>00254                 <span class="comment">/*@null@*/</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>, <span class="keywordtype">char</span> <a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a>)
<a name="l00255"></a>00255         <span class="comment">/*@uses con-&gt;execs, con-&gt;numExecs, con-&gt;flags, con-&gt;doExec,</span>
<a name="l00256"></a>00256 <span class="comment">                con-&gt;finalArgv, con-&gt;finalArgvAlloced, con-&gt;finalArgvCount @*/</span>
<a name="l00257"></a>00257         <span class="comment">/*@modifies con @*/</span>
<a name="l00258"></a>00258 {
<a name="l00259"></a>00259     <a class="code" href="structpoptItem__s.html" title="A popt alias or exec argument for poptAddItem().">poptItem</a> item;
<a name="l00260"></a>00260     <span class="keywordtype">int</span> i;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#17343ec6b740a3ac2066cf8d99488005">execs</a> == NULL || con-&gt;<a class="code" href="structpoptContext__s.html#57cfdc604ad6e3ff739c0d8d3a0e818a">numExecs</a> &lt;= 0) <span class="comment">/* XXX can't happen */</span>
<a name="l00263"></a>00263         <span class="keywordflow">return</span> 0;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     <span class="keywordflow">for</span> (i = con-&gt;<a class="code" href="structpoptContext__s.html#57cfdc604ad6e3ff739c0d8d3a0e818a">numExecs</a> - 1; i &gt;= 0; i--) {
<a name="l00266"></a>00266         item = con-&gt;<a class="code" href="structpoptContext__s.html#17343ec6b740a3ac2066cf8d99488005">execs</a> + i;
<a name="l00267"></a>00267         <span class="keywordflow">if</span> (longName &amp;&amp; !(item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> &amp;&amp;
<a name="l00268"></a>00268                         !strcmp(longName, item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>)))
<a name="l00269"></a>00269             <span class="keywordflow">continue</span>;
<a name="l00270"></a>00270         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shortName != item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a>)
<a name="l00271"></a>00271             <span class="keywordflow">continue</span>;
<a name="l00272"></a>00272         <span class="keywordflow">break</span>;
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274     <span class="keywordflow">if</span> (i &lt; 0) <span class="keywordflow">return</span> 0;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#0d532e7d187d8fd54b9de229ea1a51c4">flags</a> &amp; <a class="code" href="popt_8h.html#60a28469fcad1a3c0b2ff6f5073deab5">POPT_CONTEXT_NO_EXEC</a>)
<a name="l00278"></a>00278         <span class="keywordflow">return</span> 1;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#9359f8ed735796ace78ef225c1eb3ee9">doExec</a> == NULL) {
<a name="l00281"></a>00281         con-&gt;<a class="code" href="structpoptContext__s.html#9359f8ed735796ace78ef225c1eb3ee9">doExec</a> = con-&gt;<a class="code" href="structpoptContext__s.html#17343ec6b740a3ac2066cf8d99488005">execs</a> + i;
<a name="l00282"></a>00282         <span class="keywordflow">return</span> 1;
<a name="l00283"></a>00283     }
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     <span class="comment">/* We already have an exec to do; remember this option for next</span>
<a name="l00286"></a>00286 <span class="comment">       time 'round */</span>
<a name="l00287"></a>00287     <span class="keywordflow">if</span> ((con-&gt;<a class="code" href="structpoptContext__s.html#0c5a151e184bf3996af518c7c1a9fdbd">finalArgvCount</a> + 1) &gt;= (con-&gt;<a class="code" href="structpoptContext__s.html#22873bd65778f6f1bfb1d4bc5d827bf4">finalArgvAlloced</a>)) {
<a name="l00288"></a>00288         con-&gt;<a class="code" href="structpoptContext__s.html#22873bd65778f6f1bfb1d4bc5d827bf4">finalArgvAlloced</a> += 10;
<a name="l00289"></a>00289         con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a> = realloc(con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>,
<a name="l00290"></a>00290                         <span class="keyword">sizeof</span>(*con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>) * con-&gt;<a class="code" href="structpoptContext__s.html#22873bd65778f6f1bfb1d4bc5d827bf4">finalArgvAlloced</a>);
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     i = con-&gt;<a class="code" href="structpoptContext__s.html#0c5a151e184bf3996af518c7c1a9fdbd">finalArgvCount</a>++;
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a> != NULL) <span class="comment">/* XXX can't happen */</span>
<a name="l00295"></a>00295     {   <span class="keywordtype">char</span> *s  = malloc((longName ? strlen(longName) : 0) + 3);
<a name="l00296"></a>00296         <span class="keywordflow">if</span> (s != NULL) {        <span class="comment">/* XXX can't happen */</span>
<a name="l00297"></a>00297             <span class="keywordflow">if</span> (longName)
<a name="l00298"></a>00298                 sprintf(s, <span class="stringliteral">"--%s"</span>, longName);
<a name="l00299"></a>00299             <span class="keywordflow">else</span>
<a name="l00300"></a>00300                 sprintf(s, <span class="stringliteral">"-%c"</span>, shortName);
<a name="l00301"></a>00301             con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>[i] = s;
<a name="l00302"></a>00302         } <span class="keywordflow">else</span>
<a name="l00303"></a>00303             con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>[i] = NULL;
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306     <span class="keywordflow">return</span> 1;
<a name="l00307"></a>00307 }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 <span class="comment">/* Only one of longName, shortName may be set at a time */</span>
<a name="l00310"></a><a class="code" href="popt_8c.html#93487bfde496e3fb01b1441039d55d09">00310</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="popt_8c.html#93487bfde496e3fb01b1441039d55d09">handleAlias</a>(<span class="comment">/*@special@*/</span> <a class="code" href="structpoptContext__s.html">poptContext</a> con,
<a name="l00311"></a>00311                 <span class="comment">/*@null@*/</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>, <span class="keywordtype">char</span> <a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a>,
<a name="l00312"></a>00312                 <span class="comment">/*@exposed@*/</span> <span class="comment">/*@null@*/</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * nextCharArg)
<a name="l00313"></a>00313         <span class="comment">/*@uses con-&gt;aliases, con-&gt;numAliases, con-&gt;optionStack, con-&gt;os,</span>
<a name="l00314"></a>00314 <span class="comment">                con-&gt;os-&gt;currAlias, con-&gt;os-&gt;currAlias-&gt;option.longName @*/</span>
<a name="l00315"></a>00315         <span class="comment">/*@modifies con @*/</span>
<a name="l00316"></a>00316 {
<a name="l00317"></a>00317     <a class="code" href="structpoptItem__s.html" title="A popt alias or exec argument for poptAddItem().">poptItem</a> item = con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#358da17455ddd94a5acd74b0559aa8a5">currAlias</a>;
<a name="l00318"></a>00318     <span class="keywordtype">int</span> rc;
<a name="l00319"></a>00319     <span class="keywordtype">int</span> i;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     <span class="keywordflow">if</span> (item) {
<a name="l00322"></a>00322         <span class="keywordflow">if</span> (longName &amp;&amp; (item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> &amp;&amp;
<a name="l00323"></a>00323                 !strcmp(longName, item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>)))
<a name="l00324"></a>00324             <span class="keywordflow">return</span> 0;
<a name="l00325"></a>00325         <span class="keywordflow">if</span> (shortName &amp;&amp; shortName == item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a>)
<a name="l00326"></a>00326             <span class="keywordflow">return</span> 0;
<a name="l00327"></a>00327     }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#03cc608197cd1897d1228aef0d8bf61d">aliases</a> == NULL || con-&gt;<a class="code" href="structpoptContext__s.html#fb0ace2c6600299043a3ec8a922bc820">numAliases</a> &lt;= 0) <span class="comment">/* XXX can't happen */</span>
<a name="l00330"></a>00330         <span class="keywordflow">return</span> 0;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332     <span class="keywordflow">for</span> (i = con-&gt;<a class="code" href="structpoptContext__s.html#fb0ace2c6600299043a3ec8a922bc820">numAliases</a> - 1; i &gt;= 0; i--) {
<a name="l00333"></a>00333         item = con-&gt;<a class="code" href="structpoptContext__s.html#03cc608197cd1897d1228aef0d8bf61d">aliases</a> + i;
<a name="l00334"></a>00334         <span class="keywordflow">if</span> (longName &amp;&amp; !(item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> &amp;&amp;
<a name="l00335"></a>00335                         !strcmp(longName, item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>)))
<a name="l00336"></a>00336             <span class="keywordflow">continue</span>;
<a name="l00337"></a>00337         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shortName != item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a>)
<a name="l00338"></a>00338             <span class="keywordflow">continue</span>;
<a name="l00339"></a>00339         <span class="keywordflow">break</span>;
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341     <span class="keywordflow">if</span> (i &lt; 0) <span class="keywordflow">return</span> 0;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343     <span class="keywordflow">if</span> ((con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a> - con-&gt;<a class="code" href="structpoptContext__s.html#fb4fe00e407510f15c15de9bcdcc9a03">optionStack</a> + 1) == <a class="code" href="popt_8h.html#a50bd81d1fa1d17100540e00b5f7acfd">POPT_OPTION_DEPTH</a>)
<a name="l00344"></a>00344         <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#1502ab9ab9bffdd60f96a40aabcefb8b">POPT_ERROR_OPTSTOODEEP</a>;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346     <span class="keywordflow">if</span> (nextCharArg &amp;&amp; *nextCharArg)
<a name="l00347"></a>00347         con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a> = nextCharArg;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>++;
<a name="l00350"></a>00350     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a> = 0;
<a name="l00351"></a>00351     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#585e45e37b8f7a899434b0f94bd009b7">stuffed</a> = 0;
<a name="l00352"></a>00352     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> = NULL;
<a name="l00353"></a>00353     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a> = NULL;
<a name="l00354"></a>00354     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#358da17455ddd94a5acd74b0559aa8a5">currAlias</a> = con-&gt;<a class="code" href="structpoptContext__s.html#03cc608197cd1897d1228aef0d8bf61d">aliases</a> + i;
<a name="l00355"></a>00355     rc = <a class="code" href="popt_8h.html#5fcba044ce909a898284af1c0e38fd3b" title="Duplicate an argument array.">poptDupArgv</a>(con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#358da17455ddd94a5acd74b0559aa8a5">currAlias</a>-&gt;<a class="code" href="structpoptItem__s.html#d96c5ac77deda4c55124f3691b2988a4">argc</a>, con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#358da17455ddd94a5acd74b0559aa8a5">currAlias</a>-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a>,
<a name="l00356"></a>00356                 &amp;con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a>, &amp;con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>);
<a name="l00357"></a>00357     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a> = NULL;
<a name="l00358"></a>00358 
<a name="l00359"></a>00359     <span class="keywordflow">return</span> (rc ? rc : 1);
<a name="l00360"></a>00360 }
<a name="l00361"></a>00361 
<a name="l00362"></a><a class="code" href="popt_8c.html#386ac781cacc159b738a1392f7676387">00362</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="popt_8c.html#386ac781cacc159b738a1392f7676387">execCommand</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con)
<a name="l00363"></a>00363         <span class="comment">/*@globals internalState @*/</span>
<a name="l00364"></a>00364         <span class="comment">/*@modifies internalState @*/</span>
<a name="l00365"></a>00365 {
<a name="l00366"></a>00366     <a class="code" href="structpoptItem__s.html" title="A popt alias or exec argument for poptAddItem().">poptItem</a> item = con-&gt;<a class="code" href="structpoptContext__s.html#9359f8ed735796ace78ef225c1eb3ee9">doExec</a>;
<a name="l00367"></a>00367     <span class="keyword">const</span> <span class="keywordtype">char</span> ** argv = NULL;
<a name="l00368"></a>00368     <span class="keywordtype">int</span> argc = 0;
<a name="l00369"></a>00369     <span class="keywordtype">int</span> rc;
<a name="l00370"></a>00370     <span class="keywordtype">int</span> ec = <a class="code" href="popt_8h.html#94d19f2335b8a6d1b0862edcd4823b3d">POPT_ERROR_ERRNO</a>;
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     <span class="keywordflow">if</span> (item == NULL) <span class="comment">/*XXX can't happen*/</span>
<a name="l00373"></a>00373         <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#28bb1cf1823622c3510d2976da33ad06">POPT_ERROR_NOARG</a>;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="keywordflow">if</span> (item-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a> == NULL || item-&gt;<a class="code" href="structpoptItem__s.html#d96c5ac77deda4c55124f3691b2988a4">argc</a> &lt; 1 ||
<a name="l00376"></a>00376         (!con-&gt;<a class="code" href="structpoptContext__s.html#1c86e964008dc6a755671b412ac6f036">execAbsolute</a> &amp;&amp; strchr(item-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a>[0], <span class="charliteral">'/'</span>)))
<a name="l00377"></a>00377             <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#28bb1cf1823622c3510d2976da33ad06">POPT_ERROR_NOARG</a>;
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     argv = malloc(<span class="keyword">sizeof</span>(*argv) *
<a name="l00380"></a>00380                         (6 + item-&gt;<a class="code" href="structpoptItem__s.html#d96c5ac77deda4c55124f3691b2988a4">argc</a> + con-&gt;<a class="code" href="structpoptContext__s.html#a7a13994df6f103d61fed3bd5bada6e2">numLeftovers</a> + con-&gt;<a class="code" href="structpoptContext__s.html#0c5a151e184bf3996af518c7c1a9fdbd">finalArgvCount</a>));
<a name="l00381"></a>00381     <span class="keywordflow">if</span> (argv == NULL) <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#94b752bdfe50201136ceb0402fd93599">POPT_ERROR_MALLOC</a>;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="keywordflow">if</span> (!strchr(item-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a>[0], <span class="charliteral">'/'</span>) &amp;&amp; con-&gt;<a class="code" href="structpoptContext__s.html#3a8c9082b8dd21f720c24e492519971c">execPath</a> != NULL) {
<a name="l00384"></a>00384         <span class="keywordtype">char</span> *s = malloc(strlen(con-&gt;<a class="code" href="structpoptContext__s.html#3a8c9082b8dd21f720c24e492519971c">execPath</a>) + strlen(item-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a>[0]) + <span class="keyword">sizeof</span>(<span class="stringliteral">"/"</span>));
<a name="l00385"></a>00385         <span class="keywordflow">if</span> (s)
<a name="l00386"></a>00386             sprintf(s, <span class="stringliteral">"%s/%s"</span>, con-&gt;<a class="code" href="structpoptContext__s.html#3a8c9082b8dd21f720c24e492519971c">execPath</a>, item-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a>[0]);
<a name="l00387"></a>00387         argv[argc] = s;
<a name="l00388"></a>00388     } <span class="keywordflow">else</span>
<a name="l00389"></a>00389         argv[argc] = <a class="code" href="findme_8c.html#3e0852ae8434ab0e918cc0a866a159e9" title="Return absolute path to executable by searching PATH.">POPT_findProgramPath</a>(item-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a>[0]);
<a name="l00390"></a>00390     <span class="keywordflow">if</span> (argv[argc++] == NULL) {
<a name="l00391"></a>00391         ec = <a class="code" href="popt_8h.html#28bb1cf1823622c3510d2976da33ad06">POPT_ERROR_NOARG</a>;
<a name="l00392"></a>00392         <span class="keywordflow">goto</span> exit;
<a name="l00393"></a>00393     }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     <span class="keywordflow">if</span> (item-&gt;<a class="code" href="structpoptItem__s.html#d96c5ac77deda4c55124f3691b2988a4">argc</a> &gt; 1) {
<a name="l00396"></a>00396         memcpy(argv + argc, item-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a> + 1, <span class="keyword">sizeof</span>(*argv) * (item-&gt;<a class="code" href="structpoptItem__s.html#d96c5ac77deda4c55124f3691b2988a4">argc</a> - 1));
<a name="l00397"></a>00397         argc += (item-&gt;<a class="code" href="structpoptItem__s.html#d96c5ac77deda4c55124f3691b2988a4">argc</a> - 1);
<a name="l00398"></a>00398     }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a> != NULL &amp;&amp; con-&gt;<a class="code" href="structpoptContext__s.html#0c5a151e184bf3996af518c7c1a9fdbd">finalArgvCount</a> &gt; 0) {
<a name="l00401"></a>00401         memcpy(argv + argc, con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>,
<a name="l00402"></a>00402                 <span class="keyword">sizeof</span>(*argv) * con-&gt;<a class="code" href="structpoptContext__s.html#0c5a151e184bf3996af518c7c1a9fdbd">finalArgvCount</a>);
<a name="l00403"></a>00403         argc += con-&gt;<a class="code" href="structpoptContext__s.html#0c5a151e184bf3996af518c7c1a9fdbd">finalArgvCount</a>;
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a> != NULL &amp;&amp; con-&gt;<a class="code" href="structpoptContext__s.html#a7a13994df6f103d61fed3bd5bada6e2">numLeftovers</a> &gt; 0) {
<a name="l00407"></a>00407         memcpy(argv + argc, con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a>, <span class="keyword">sizeof</span>(*argv) * con-&gt;<a class="code" href="structpoptContext__s.html#a7a13994df6f103d61fed3bd5bada6e2">numLeftovers</a>);
<a name="l00408"></a>00408         argc += con-&gt;<a class="code" href="structpoptContext__s.html#a7a13994df6f103d61fed3bd5bada6e2">numLeftovers</a>;
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     argv[argc] = NULL;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 <span class="preprocessor">#if defined(hpux) || defined(__hpux)</span>
<a name="l00414"></a>00414 <span class="preprocessor"></span>    rc = setresgid(getgid(), getgid(),-1);
<a name="l00415"></a>00415     <span class="keywordflow">if</span> (rc) <span class="keywordflow">goto</span> exit;
<a name="l00416"></a>00416     rc = setresuid(getuid(), getuid(),-1);
<a name="l00417"></a>00417     <span class="keywordflow">if</span> (rc) <span class="keywordflow">goto</span> exit;
<a name="l00418"></a>00418 <span class="preprocessor">#else</span>
<a name="l00419"></a>00419 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00420"></a>00420 <span class="comment"> * XXX " ... on BSD systems setuid() should be preferred over setreuid()"</span>
<a name="l00421"></a>00421 <span class="comment"> * XXX  sez' Timur Bakeyev &lt;mc@bat.ru&gt;</span>
<a name="l00422"></a>00422 <span class="comment"> * XXX  from Norbert Warmuth &lt;nwarmuth@privat.circular.de&gt;</span>
<a name="l00423"></a>00423 <span class="comment"> */</span>
<a name="l00424"></a>00424 <span class="preprocessor">#if defined(HAVE_SETUID)</span>
<a name="l00425"></a>00425 <span class="preprocessor"></span>    rc = setgid(getgid());
<a name="l00426"></a>00426     <span class="keywordflow">if</span> (rc) <span class="keywordflow">goto</span> exit;
<a name="l00427"></a>00427     rc = setuid(getuid());
<a name="l00428"></a>00428     <span class="keywordflow">if</span> (rc) <span class="keywordflow">goto</span> exit;
<a name="l00429"></a>00429 <span class="preprocessor">#elif defined (HAVE_SETREUID)</span>
<a name="l00430"></a>00430 <span class="preprocessor"></span>    rc = setregid(getgid(), getgid());
<a name="l00431"></a>00431     <span class="keywordflow">if</span> (rc) <span class="keywordflow">goto</span> exit;
<a name="l00432"></a>00432     rc = setreuid(getuid(), getuid());
<a name="l00433"></a>00433     <span class="keywordflow">if</span> (rc) <span class="keywordflow">goto</span> exit;
<a name="l00434"></a>00434 <span class="preprocessor">#else</span>
<a name="l00435"></a>00435 <span class="preprocessor"></span>    ; <span class="comment">/* Can't drop privileges */</span>
<a name="l00436"></a>00436 <span class="preprocessor">#endif</span>
<a name="l00437"></a>00437 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00438"></a>00438 <span class="preprocessor"></span>
<a name="l00439"></a>00439 <span class="preprocessor">#ifdef  MYDEBUG</span>
<a name="l00440"></a>00440 <span class="preprocessor"></span><span class="keywordflow">if</span> (_popt_debug)
<a name="l00441"></a>00441     {   <span class="keyword">const</span> <span class="keywordtype">char</span> ** avp;
<a name="l00442"></a>00442         fprintf(stderr, <span class="stringliteral">"==&gt; execvp(%s) argv[%d]:"</span>, argv[0], argc);
<a name="l00443"></a>00443         <span class="keywordflow">for</span> (avp = argv; *avp; avp++)
<a name="l00444"></a>00444             fprintf(stderr, <span class="stringliteral">" '%s'"</span>, *avp);
<a name="l00445"></a>00445         fprintf(stderr, <span class="stringliteral">"\n"</span>);
<a name="l00446"></a>00446     }
<a name="l00447"></a>00447 <span class="preprocessor">#endif</span>
<a name="l00448"></a>00448 <span class="preprocessor"></span>
<a name="l00449"></a>00449 <span class="comment">/*@-nullstate@*/</span>
<a name="l00450"></a>00450     rc = execvp(argv[0], (<span class="keywordtype">char</span> *<span class="keyword">const</span> *)argv);
<a name="l00451"></a>00451 <span class="comment">/*@=nullstate@*/</span>
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 exit:
<a name="l00454"></a>00454     <span class="keywordflow">if</span> (argv) {
<a name="l00455"></a>00455         <span class="keywordflow">if</span> (argv[0])
<a name="l00456"></a>00456             free((<span class="keywordtype">void</span> *)argv[0]);
<a name="l00457"></a>00457         free(argv);
<a name="l00458"></a>00458     }
<a name="l00459"></a>00459     <span class="keywordflow">return</span> ec;
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 <span class="comment">/*@observer@*/</span> <span class="comment">/*@null@*/</span> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpoptOption.html">poptOption</a> *
<a name="l00463"></a><a class="code" href="popt_8c.html#cdacf20be5b64c006416bdd6e71b5b3e">00463</a> <a class="code" href="popt_8c.html#cdacf20be5b64c006416bdd6e71b5b3e">findOption</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structpoptOption.html">poptOption</a> * opt, <span class="comment">/*@null@*/</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>, <span class="keywordtype">int</span> longNameLen,
<a name="l00464"></a>00464                 <span class="keywordtype">char</span> <a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a>,
<a name="l00465"></a>00465                 <span class="comment">/*@null@*/</span> <span class="comment">/*@out@*/</span> <a class="code" href="popt_8h.html#f783a37f762ae2234b039141e64e708c" title="Table callback prototype.">poptCallbackType</a> * callback,
<a name="l00466"></a>00466                 <span class="comment">/*@null@*/</span> <span class="comment">/*@out@*/</span> <span class="keyword">const</span> <span class="keywordtype">void</span> ** callbackData,
<a name="l00467"></a>00467                 <span class="keywordtype">int</span> singleDash)
<a name="l00468"></a>00468         <span class="comment">/*@modifies *callback, *callbackData */</span>
<a name="l00469"></a>00469 {
<a name="l00470"></a>00470     <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpoptOption.html">poptOption</a> * cb = NULL;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     <span class="comment">/* This happens when a single - is given */</span>
<a name="l00473"></a>00473     <span class="keywordflow">if</span> (singleDash &amp;&amp; !shortName &amp;&amp; (longName &amp;&amp; *longName == <span class="charliteral">'\0'</span>))
<a name="l00474"></a>00474         shortName = <span class="charliteral">'-'</span>;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <span class="keywordflow">for</span> (; opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> || opt-&gt;<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a> || opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>; opt++) {
<a name="l00477"></a>00477 
<a name="l00478"></a>00478         <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#a004e7eeed0d7c6e51d9792fe049bf50">POPT_ARG_INCLUDE_TABLE</a>) {
<a name="l00479"></a>00479             <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpoptOption.html">poptOption</a> * opt2;
<a name="l00480"></a>00480             <span class="keywordtype">void</span> * <a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a> = opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482             <span class="comment">/* XXX sick hack to preserve pretense of ABI. */</span>
<a name="l00483"></a>00483             <span class="keywordflow">if</span> (arg == <a class="code" href="popt_8h.html#0c493753b1c5ee878e7addf558874633" title="Auto help table options.">poptHelpOptions</a>) arg = <a class="code" href="popt_8h.html#922c332675c30038924eb94b30b2ded5">poptHelpOptionsI18N</a>;
<a name="l00484"></a>00484             <span class="comment">/* Recurse on included sub-tables. */</span>
<a name="l00485"></a>00485             <span class="keywordflow">if</span> (arg == NULL) <span class="keywordflow">continue</span>;  <span class="comment">/* XXX program error */</span>
<a name="l00486"></a>00486             opt2 = <a class="code" href="popt_8c.html#cdacf20be5b64c006416bdd6e71b5b3e">findOption</a>(arg, longName, longNameLen, shortName, callback,
<a name="l00487"></a>00487                               callbackData, singleDash);
<a name="l00488"></a>00488             <span class="keywordflow">if</span> (opt2 == NULL) <span class="keywordflow">continue</span>;
<a name="l00489"></a>00489             <span class="comment">/* Sub-table data will be inheirited if no data yet. */</span>
<a name="l00490"></a>00490             <span class="keywordflow">if</span> (!(callback &amp;&amp; *callback)) <span class="keywordflow">return</span> opt2;
<a name="l00491"></a>00491             <span class="keywordflow">if</span> (!(callbackData &amp;&amp; *callbackData == NULL)) <span class="keywordflow">return</span> opt2;
<a name="l00492"></a>00492 <span class="comment">/*@-observertrans -dependenttrans @*/</span>
<a name="l00493"></a>00493             *callbackData = opt-&gt;<a class="code" href="structpoptOption.html#d0123e0f28a19468eb34e89753064745">descrip</a>;
<a name="l00494"></a>00494 <span class="comment">/*@=observertrans =dependenttrans @*/</span>
<a name="l00495"></a>00495             <span class="keywordflow">return</span> opt2;
<a name="l00496"></a>00496         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#d13a93a7e60cf78b2dd0a22db8393ae2">POPT_ARG_CALLBACK</a>) {
<a name="l00497"></a>00497             cb = opt;
<a name="l00498"></a>00498         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (longName != NULL &amp;&amp; opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> != NULL &amp;&amp;
<a name="l00499"></a>00499                    (!singleDash || (opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#5f59cf9e70e26f26b82161e0ce2b4741">POPT_ARGFLAG_ONEDASH</a>)) &amp;&amp;
<a name="l00500"></a>00500                    (!strncmp(longName, opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>, longNameLen) &amp;&amp; strlen(opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>) == longNameLen))
<a name="l00501"></a>00501         {
<a name="l00502"></a>00502             <span class="keywordflow">break</span>;
<a name="l00503"></a>00503         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shortName &amp;&amp; shortName == opt-&gt;<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a>) {
<a name="l00504"></a>00504             <span class="keywordflow">break</span>;
<a name="l00505"></a>00505         }
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> == NULL &amp;&amp; !opt-&gt;<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a>)
<a name="l00509"></a>00509         <span class="keywordflow">return</span> NULL;
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 <span class="comment">/*@-modobserver -mods @*/</span>
<a name="l00512"></a>00512     <span class="keywordflow">if</span> (callback) *callback = NULL;
<a name="l00513"></a>00513     <span class="keywordflow">if</span> (callbackData) *callbackData = NULL;
<a name="l00514"></a>00514     <span class="keywordflow">if</span> (cb) {
<a name="l00515"></a>00515         <span class="keywordflow">if</span> (callback)
<a name="l00516"></a>00516         <span class="comment">/*@-castfcnptr@*/</span>
<a name="l00517"></a>00517             *callback = (<a class="code" href="popt_8h.html#f783a37f762ae2234b039141e64e708c" title="Table callback prototype.">poptCallbackType</a>)cb-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>;
<a name="l00518"></a>00518         <span class="comment">/*@=castfcnptr@*/</span>
<a name="l00519"></a>00519         if (!(cb-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#9e42cc7ed37a800f8b14bd69c51dbdbf">POPT_CBFLAG_INC_DATA</a>)) {
<a name="l00520"></a>00520             <span class="keywordflow">if</span> (callbackData)
<a name="l00521"></a>00521 <span class="comment">/*@-observertrans@*/</span>    <span class="comment">/* FIX: typedef double indirection. */</span>
<a name="l00522"></a>00522                 *callbackData = cb-&gt;<a class="code" href="structpoptOption.html#d0123e0f28a19468eb34e89753064745">descrip</a>;
<a name="l00523"></a>00523 <span class="comment">/*@=observertrans@*/</span>
<a name="l00524"></a>00524         }
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526 <span class="comment">/*@=modobserver =mods @*/</span>
<a name="l00527"></a>00527 
<a name="l00528"></a>00528     <span class="keywordflow">return</span> opt;
<a name="l00529"></a>00529 }
<a name="l00530"></a>00530 
<a name="l00531"></a><a class="code" href="popt_8c.html#fd4bf8db7028607236ce38c39ae9b921">00531</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="popt_8c.html#fd4bf8db7028607236ce38c39ae9b921">findNextArg</a>(<span class="comment">/*@special@*/</span> <a class="code" href="structpoptContext__s.html">poptContext</a> con,
<a name="l00532"></a>00532                 <span class="keywordtype">unsigned</span> argx, <span class="keywordtype">int</span> delete_arg)
<a name="l00533"></a>00533         <span class="comment">/*@uses con-&gt;optionStack, con-&gt;os,</span>
<a name="l00534"></a>00534 <span class="comment">                con-&gt;os-&gt;next, con-&gt;os-&gt;argb, con-&gt;os-&gt;argc, con-&gt;os-&gt;argv @*/</span>
<a name="l00535"></a>00535         <span class="comment">/*@modifies con @*/</span>
<a name="l00536"></a>00536 {
<a name="l00537"></a>00537     <span class="keyword">struct </span><a class="code" href="structoptionStackEntry.html">optionStackEntry</a> * os = con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>;
<a name="l00538"></a>00538     <span class="keyword">const</span> <span class="keywordtype">char</span> * arg;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540     <span class="keywordflow">do</span> {
<a name="l00541"></a>00541         <span class="keywordtype">int</span> i;
<a name="l00542"></a>00542         arg = NULL;
<a name="l00543"></a>00543         <span class="keywordflow">while</span> (os-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a> == os-&gt;<a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a> &amp;&amp; os &gt; con-&gt;<a class="code" href="structpoptContext__s.html#fb4fe00e407510f15c15de9bcdcc9a03">optionStack</a>) os--;
<a name="l00544"></a>00544         <span class="keywordflow">if</span> (os-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a> == os-&gt;<a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a> &amp;&amp; os == con-&gt;<a class="code" href="structpoptContext__s.html#fb4fe00e407510f15c15de9bcdcc9a03">optionStack</a>) <span class="keywordflow">break</span>;
<a name="l00545"></a>00545         <span class="keywordflow">if</span> (os-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a> != NULL)
<a name="l00546"></a>00546         <span class="keywordflow">for</span> (i = os-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a>; i &lt; os-&gt;<a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a>; i++) {
<a name="l00547"></a>00547 <span class="comment">/*@-sizeoftype@*/</span>
<a name="l00548"></a>00548             <span class="keywordflow">if</span> (os-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a> &amp;&amp; <a class="code" href="poptint_8h.html#8606b44323c6450c9efe9ca1fb6b07c6">PBM_ISSET</a>(i, os-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a>))
<a name="l00549"></a>00549                 <span class="comment">/*@innercontinue@*/</span> <span class="keywordflow">continue</span>;
<a name="l00550"></a>00550             <span class="keywordflow">if</span> (*os-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>[i] == <span class="charliteral">'-'</span>)
<a name="l00551"></a>00551                 <span class="comment">/*@innercontinue@*/</span> <span class="keywordflow">continue</span>;
<a name="l00552"></a>00552             <span class="keywordflow">if</span> (--argx &gt; 0)
<a name="l00553"></a>00553                 <span class="comment">/*@innercontinue@*/</span> <span class="keywordflow">continue</span>;
<a name="l00554"></a>00554             arg = os-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>[i];
<a name="l00555"></a>00555             <span class="keywordflow">if</span> (delete_arg) {
<a name="l00556"></a>00556                 <span class="keywordflow">if</span> (os-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a> == NULL) os-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a> = <a class="code" href="poptint_8h.html#0a7350494d7d8fc4caeb0bb317d186c7">PBM_ALLOC</a>(os-&gt;<a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a>);
<a name="l00557"></a>00557                 <span class="keywordflow">if</span> (os-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a> != NULL)   <span class="comment">/* XXX can't happen */</span>
<a name="l00558"></a>00558                     <a class="code" href="poptint_8h.html#087411fde1f2c9163414380e67967297">PBM_SET</a>(i, os-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a>);
<a name="l00559"></a>00559             }
<a name="l00560"></a>00560             <span class="comment">/*@innerbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00561"></a>00561 <span class="comment">/*@=sizeoftype@*/</span>
<a name="l00562"></a>00562         }
<a name="l00563"></a>00563         <span class="keywordflow">if</span> (os &gt; con-&gt;<a class="code" href="structpoptContext__s.html#fb4fe00e407510f15c15de9bcdcc9a03">optionStack</a>) os--;
<a name="l00564"></a>00564     } <span class="keywordflow">while</span> (arg == NULL);
<a name="l00565"></a>00565     <span class="keywordflow">return</span> arg;
<a name="l00566"></a>00566 }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 <span class="keyword">static</span> <span class="comment">/*@only@*/</span> <span class="comment">/*@null@*/</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00569"></a><a class="code" href="popt_8c.html#36adc119ee9adb494f2bf10212ccd899">00569</a> <a class="code" href="popt_8c.html#36adc119ee9adb494f2bf10212ccd899">expandNextArg</a>(<span class="comment">/*@special@*/</span> <a class="code" href="structpoptContext__s.html">poptContext</a> con, <span class="keyword">const</span> <span class="keywordtype">char</span> * s)
<a name="l00570"></a>00570         <span class="comment">/*@uses con-&gt;optionStack, con-&gt;os,</span>
<a name="l00571"></a>00571 <span class="comment">                con-&gt;os-&gt;next, con-&gt;os-&gt;argb, con-&gt;os-&gt;argc, con-&gt;os-&gt;argv @*/</span>
<a name="l00572"></a>00572         <span class="comment">/*@modifies con @*/</span>
<a name="l00573"></a>00573 {
<a name="l00574"></a>00574     <span class="keyword">const</span> <span class="keywordtype">char</span> * a = NULL;
<a name="l00575"></a>00575     <span class="keywordtype">size_t</span> alen;
<a name="l00576"></a>00576     <span class="keywordtype">char</span> *t, *te;
<a name="l00577"></a>00577     <span class="keywordtype">size_t</span> tn = strlen(s) + 1;
<a name="l00578"></a>00578     <span class="keywordtype">char</span> c;
<a name="l00579"></a>00579 
<a name="l00580"></a>00580     te = t = malloc(tn);;
<a name="l00581"></a>00581     <span class="keywordflow">if</span> (t == NULL) <span class="keywordflow">return</span> NULL;         <span class="comment">/* XXX can't happen */</span>
<a name="l00582"></a>00582     <span class="keywordflow">while</span> ((c = *s++) != <span class="charliteral">'\0'</span>) {
<a name="l00583"></a>00583         <span class="keywordflow">switch</span> (c) {
<a name="l00584"></a>00584 <span class="preprocessor">#if 0   </span><span class="comment">/* XXX can't do this */</span>
<a name="l00585"></a>00585         <span class="keywordflow">case</span> <span class="charliteral">'\\'</span>:      <span class="comment">/* escape */</span>
<a name="l00586"></a>00586             c = *s++;
<a name="l00587"></a>00587             <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00588"></a>00588 <span class="preprocessor">#endif</span>
<a name="l00589"></a>00589 <span class="preprocessor"></span>        <span class="keywordflow">case</span> <span class="charliteral">'!'</span>:
<a name="l00590"></a>00590             <span class="keywordflow">if</span> (!(s[0] == <span class="charliteral">'#'</span> &amp;&amp; s[1] == <span class="charliteral">':'</span> &amp;&amp; s[2] == <span class="charliteral">'+'</span>))
<a name="l00591"></a>00591                 <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00592"></a>00592             <span class="comment">/* XXX Make sure that findNextArg deletes only next arg. */</span>
<a name="l00593"></a>00593             <span class="keywordflow">if</span> (a == NULL) {
<a name="l00594"></a>00594                 <span class="keywordflow">if</span> ((a = <a class="code" href="popt_8c.html#fd4bf8db7028607236ce38c39ae9b921">findNextArg</a>(con, 1U, 1)) == NULL)
<a name="l00595"></a>00595                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00596"></a>00596             }
<a name="l00597"></a>00597             s += 3;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599             alen = strlen(a);
<a name="l00600"></a>00600             tn += alen;
<a name="l00601"></a>00601             *te = <span class="charliteral">'\0'</span>;
<a name="l00602"></a>00602             t = realloc(t, tn);
<a name="l00603"></a>00603             te = t + strlen(t);
<a name="l00604"></a>00604             strncpy(te, a, alen); te += alen;
<a name="l00605"></a>00605             <span class="keywordflow">continue</span>;
<a name="l00606"></a>00606             <span class="comment">/*@notreached@*/</span> <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00607"></a>00607         <span class="keywordflow">default</span>:
<a name="l00608"></a>00608             <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00609"></a>00609         }
<a name="l00610"></a>00610         *te++ = c;
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612     *te = <span class="charliteral">'\0'</span>;
<a name="l00613"></a>00613     t = realloc(t, strlen(t) + 1);      <span class="comment">/* XXX memory leak, hard to plug */</span>
<a name="l00614"></a>00614     <span class="keywordflow">return</span> t;
<a name="l00615"></a>00615 }
<a name="l00616"></a>00616 
<a name="l00617"></a><a class="code" href="popt_8c.html#e4224d02aba0c3419d25658c9f180011">00617</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="popt_8c.html#e4224d02aba0c3419d25658c9f180011">poptStripArg</a>(<span class="comment">/*@special@*/</span> <a class="code" href="structpoptContext__s.html">poptContext</a> con, <span class="keywordtype">int</span> which)
<a name="l00618"></a>00618         <span class="comment">/*@uses con-&gt;arg_strip, con-&gt;optionStack @*/</span>
<a name="l00619"></a>00619         <span class="comment">/*@defines con-&gt;arg_strip @*/</span>
<a name="l00620"></a>00620         <span class="comment">/*@modifies con @*/</span>
<a name="l00621"></a>00621 {
<a name="l00622"></a>00622 <span class="comment">/*@-sizeoftype@*/</span>
<a name="l00623"></a>00623     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#6b8f9e4e2175d16b8903243819318418">arg_strip</a> == NULL)
<a name="l00624"></a>00624         con-&gt;<a class="code" href="structpoptContext__s.html#6b8f9e4e2175d16b8903243819318418">arg_strip</a> = <a class="code" href="poptint_8h.html#0a7350494d7d8fc4caeb0bb317d186c7">PBM_ALLOC</a>(con-&gt;<a class="code" href="structpoptContext__s.html#fb4fe00e407510f15c15de9bcdcc9a03">optionStack</a>[0].<a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a>);
<a name="l00625"></a>00625     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#6b8f9e4e2175d16b8903243819318418">arg_strip</a> != NULL)         <span class="comment">/* XXX can't happen */</span>
<a name="l00626"></a>00626     <a class="code" href="poptint_8h.html#087411fde1f2c9163414380e67967297">PBM_SET</a>(which, con-&gt;<a class="code" href="structpoptContext__s.html#6b8f9e4e2175d16b8903243819318418">arg_strip</a>);
<a name="l00627"></a>00627 <span class="comment">/*@=sizeoftype@*/</span>
<a name="l00628"></a>00628 <span class="comment">/*@-compdef@*/</span> <span class="comment">/* LCL: con-&gt;arg_strip undefined? */</span>
<a name="l00629"></a>00629     <span class="keywordflow">return</span>;
<a name="l00630"></a>00630 <span class="comment">/*@=compdef@*/</span>
<a name="l00631"></a>00631 }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633 <span class="comment">/*@unchecked@*/</span>
<a name="l00634"></a><a class="code" href="popt_8c.html#e21f357c223957d36046a0d71cc6aed7">00634</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="popt_8c.html#e21f357c223957d36046a0d71cc6aed7">seed</a> = 0;
<a name="l00635"></a>00635 
<a name="l00636"></a>00636 <span class="comment">/*@-bitwisesigned@*/</span>    <span class="comment">/* LCL: logical ops with unsigned. */</span>
<a name="l00637"></a><a class="code" href="popt_8h.html#d5a5b29113defd6974d9a6e30a4ec3ad">00637</a> <span class="keywordtype">int</span> <a class="code" href="popt_8c.html#d5a5b29113defd6974d9a6e30a4ec3ad" title="Save a long, performing logical operation with value.">poptSaveLong</a>(<span class="keywordtype">long</span> * arg, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> argInfo, <span class="keywordtype">long</span> aLong)
<a name="l00638"></a>00638 {
<a name="l00639"></a>00639     <span class="comment">/* XXX Check alignment, may fail on funky platforms. */</span>
<a name="l00640"></a>00640     <span class="keywordflow">if</span> (arg == NULL || (((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)arg) &amp; (<span class="keyword">sizeof</span>(*arg)-1)))
<a name="l00641"></a>00641         <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#cb3028810d0b6fcc1b86425a09b1805b">POPT_ERROR_NULLARG</a>;
<a name="l00642"></a>00642 
<a name="l00643"></a>00643     <span class="keywordflow">if</span> (aLong != 0 &amp;&amp; argInfo &amp; <a class="code" href="popt_8h.html#298450ea73f6c2f87530ff623cc1927a">POPT_ARGFLAG_RANDOM</a>) {
<a name="l00644"></a>00644         <span class="keywordflow">if</span> (!seed) {
<a name="l00645"></a>00645             srandom((<span class="keywordtype">unsigned</span>)getpid());
<a name="l00646"></a>00646             srandom((<span class="keywordtype">unsigned</span>)random());
<a name="l00647"></a>00647         }
<a name="l00648"></a>00648         aLong = random() % (aLong &gt; 0 ? aLong : -aLong);
<a name="l00649"></a>00649         aLong++;
<a name="l00650"></a>00650     }
<a name="l00651"></a>00651     <span class="keywordflow">if</span> (argInfo &amp; <a class="code" href="popt_8h.html#3c15da0823015a00fdedd17825282113">POPT_ARGFLAG_NOT</a>)
<a name="l00652"></a>00652         aLong = ~aLong;
<a name="l00653"></a>00653     <span class="keywordflow">switch</span> (argInfo &amp; <a class="code" href="popt_8h.html#9796f1716716ea252e2b1dafc7edb8c8">POPT_ARGFLAG_LOGICALOPS</a>) {
<a name="l00654"></a>00654     <span class="keywordflow">case</span> 0:
<a name="l00655"></a>00655         *arg = aLong;
<a name="l00656"></a>00656         <span class="keywordflow">break</span>;
<a name="l00657"></a>00657     <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#633f58e383a11abb7fc4e827ac3e581b">POPT_ARGFLAG_OR</a>:
<a name="l00658"></a>00658         *arg |= aLong;
<a name="l00659"></a>00659         <span class="keywordflow">break</span>;
<a name="l00660"></a>00660     <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#4b4f090c9966b8aa0811a3b2a43325ad">POPT_ARGFLAG_AND</a>:
<a name="l00661"></a>00661         *arg &amp;= aLong;
<a name="l00662"></a>00662         <span class="keywordflow">break</span>;
<a name="l00663"></a>00663     <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#b309dd56e94772b395b7ad1fc4dba14a">POPT_ARGFLAG_XOR</a>:
<a name="l00664"></a>00664         *arg ^= aLong;
<a name="l00665"></a>00665         <span class="keywordflow">break</span>;
<a name="l00666"></a>00666     <span class="keywordflow">default</span>:
<a name="l00667"></a>00667         <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#7075a89582a670d9ea2a1c16e3412faf">POPT_ERROR_BADOPERATION</a>;
<a name="l00668"></a>00668         <span class="comment">/*@notreached@*/</span> <span class="keywordflow">break</span>;
<a name="l00669"></a>00669     }
<a name="l00670"></a>00670     <span class="keywordflow">return</span> 0;
<a name="l00671"></a>00671 }
<a name="l00672"></a>00672 <span class="comment">/*@=bitwisesigned@*/</span>
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 <span class="comment">/*@-bitwisesigned@*/</span>    <span class="comment">/* LCL: logical ops with unsigned. */</span>
<a name="l00675"></a><a class="code" href="popt_8h.html#24b052439c4a11b96b9834ba34c35402">00675</a> <span class="keywordtype">int</span> <a class="code" href="popt_8c.html#24b052439c4a11b96b9834ba34c35402" title="Save an integer, performing logical operation with value.">poptSaveInt</a>(<span class="comment">/*@null@*/</span> <span class="keywordtype">int</span> * arg, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> argInfo, <span class="keywordtype">long</span> aLong)
<a name="l00676"></a>00676 {
<a name="l00677"></a>00677     <span class="comment">/* XXX Check alignment, may fail on funky platforms. */</span>
<a name="l00678"></a>00678     <span class="keywordflow">if</span> (arg == NULL || (((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)arg) &amp; (<span class="keyword">sizeof</span>(*arg)-1)))
<a name="l00679"></a>00679         <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#cb3028810d0b6fcc1b86425a09b1805b">POPT_ERROR_NULLARG</a>;
<a name="l00680"></a>00680 
<a name="l00681"></a>00681     <span class="keywordflow">if</span> (aLong != 0 &amp;&amp; argInfo &amp; <a class="code" href="popt_8h.html#298450ea73f6c2f87530ff623cc1927a">POPT_ARGFLAG_RANDOM</a>) {
<a name="l00682"></a>00682         <span class="keywordflow">if</span> (!seed) {
<a name="l00683"></a>00683             srandom((<span class="keywordtype">unsigned</span>)getpid());
<a name="l00684"></a>00684             srandom((<span class="keywordtype">unsigned</span>)random());
<a name="l00685"></a>00685         }
<a name="l00686"></a>00686         aLong = random() % (aLong &gt; 0 ? aLong : -aLong);
<a name="l00687"></a>00687         aLong++;
<a name="l00688"></a>00688     }
<a name="l00689"></a>00689     <span class="keywordflow">if</span> (argInfo &amp; <a class="code" href="popt_8h.html#3c15da0823015a00fdedd17825282113">POPT_ARGFLAG_NOT</a>)
<a name="l00690"></a>00690         aLong = ~aLong;
<a name="l00691"></a>00691     <span class="keywordflow">switch</span> (argInfo &amp; <a class="code" href="popt_8h.html#9796f1716716ea252e2b1dafc7edb8c8">POPT_ARGFLAG_LOGICALOPS</a>) {
<a name="l00692"></a>00692     <span class="keywordflow">case</span> 0:
<a name="l00693"></a>00693         *arg = aLong;
<a name="l00694"></a>00694         <span class="keywordflow">break</span>;
<a name="l00695"></a>00695     <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#633f58e383a11abb7fc4e827ac3e581b">POPT_ARGFLAG_OR</a>:
<a name="l00696"></a>00696         *arg |= aLong;
<a name="l00697"></a>00697         <span class="keywordflow">break</span>;
<a name="l00698"></a>00698     <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#4b4f090c9966b8aa0811a3b2a43325ad">POPT_ARGFLAG_AND</a>:
<a name="l00699"></a>00699         *arg &amp;= aLong;
<a name="l00700"></a>00700         <span class="keywordflow">break</span>;
<a name="l00701"></a>00701     <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#b309dd56e94772b395b7ad1fc4dba14a">POPT_ARGFLAG_XOR</a>:
<a name="l00702"></a>00702         *arg ^= aLong;
<a name="l00703"></a>00703         <span class="keywordflow">break</span>;
<a name="l00704"></a>00704     <span class="keywordflow">default</span>:
<a name="l00705"></a>00705         <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#7075a89582a670d9ea2a1c16e3412faf">POPT_ERROR_BADOPERATION</a>;
<a name="l00706"></a>00706         <span class="comment">/*@notreached@*/</span> <span class="keywordflow">break</span>;
<a name="l00707"></a>00707     }
<a name="l00708"></a>00708     <span class="keywordflow">return</span> 0;
<a name="l00709"></a>00709 }
<a name="l00710"></a>00710 <span class="comment">/*@=bitwisesigned@*/</span>
<a name="l00711"></a>00711 
<a name="l00712"></a>00712 <span class="comment">/* returns 'val' element, -1 on last item, POPT_ERROR_* on error */</span>
<a name="l00713"></a><a class="code" href="popt_8h.html#7610b6fe74ccf5c7d2b5e67beca41605">00713</a> <span class="keywordtype">int</span> <a class="code" href="popt_8c.html#7610b6fe74ccf5c7d2b5e67beca41605" title="Return value of next option found.">poptGetNextOpt</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con)
<a name="l00714"></a>00714 {
<a name="l00715"></a>00715     <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structpoptOption.html">poptOption</a> * opt = NULL;
<a name="l00716"></a>00716     <span class="keywordtype">int</span> done = 0;
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     <span class="keywordflow">if</span> (con == NULL)
<a name="l00719"></a>00719         <span class="keywordflow">return</span> -1;
<a name="l00720"></a>00720     <span class="keywordflow">while</span> (!done) {
<a name="l00721"></a>00721         <span class="keyword">const</span> <span class="keywordtype">char</span> * origOptString = NULL;
<a name="l00722"></a>00722         <a class="code" href="popt_8h.html#f783a37f762ae2234b039141e64e708c" title="Table callback prototype.">poptCallbackType</a> cb = NULL;
<a name="l00723"></a>00723         <span class="keyword">const</span> <span class="keywordtype">void</span> * cbData = NULL;
<a name="l00724"></a>00724         <span class="keyword">const</span> <span class="keywordtype">char</span> * longArg = NULL;
<a name="l00725"></a>00725         <span class="keywordtype">int</span> canstrip = 0;
<a name="l00726"></a>00726         <span class="keywordtype">int</span> shorty = 0;
<a name="l00727"></a>00727 
<a name="l00728"></a>00728         <span class="keywordflow">while</span> (!con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a> &amp;&amp; con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a> == con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a>
<a name="l00729"></a>00729                 &amp;&amp; con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a> &gt; con-&gt;<a class="code" href="structpoptContext__s.html#fb4fe00e407510f15c15de9bcdcc9a03">optionStack</a>) {
<a name="l00730"></a>00730             <a class="code" href="popt_8c.html#9fdab699d4f5021e1507fecc87a1363f">cleanOSE</a>(con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>--);
<a name="l00731"></a>00731         }
<a name="l00732"></a>00732         <span class="keywordflow">if</span> (!con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a> &amp;&amp; con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a> == con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a>) {
<a name="l00733"></a>00733             <a class="code" href="popt_8c.html#0b648b607123e3ad9d78843b41a8cc78">invokeCallbacksPOST</a>(con, con-&gt;<a class="code" href="structpoptContext__s.html#dad9df807e74fca28fae63d26a2f01b2">options</a>);
<a name="l00734"></a>00734 
<a name="l00735"></a>00735             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#e5dcf300c4e97d37d9977ef507d48fb2">maincall</a>) {
<a name="l00736"></a>00736                 <span class="comment">/*@-noeffectuncon @*/</span>
<a name="l00737"></a>00737                 (void) (*con-&gt;<a class="code" href="structpoptContext__s.html#e5dcf300c4e97d37d9977ef507d48fb2">maincall</a>) (con-&gt;<a class="code" href="structpoptContext__s.html#0c5a151e184bf3996af518c7c1a9fdbd">finalArgvCount</a>, con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>);
<a name="l00738"></a>00738                 <span class="comment">/*@=noeffectuncon @*/</span>
<a name="l00739"></a>00739                 <span class="keywordflow">return</span> -1;
<a name="l00740"></a>00740             }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#9359f8ed735796ace78ef225c1eb3ee9">doExec</a>) <span class="keywordflow">return</span> <a class="code" href="popt_8c.html#386ac781cacc159b738a1392f7676387">execCommand</a>(con);
<a name="l00743"></a>00743             <span class="keywordflow">return</span> -1;
<a name="l00744"></a>00744         }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746         <span class="comment">/* Process next long option */</span>
<a name="l00747"></a>00747         <span class="keywordflow">if</span> (!con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a>) {
<a name="l00748"></a>00748             <span class="keyword">const</span> <span class="keywordtype">char</span> * optString;
<a name="l00749"></a>00749             <span class="keywordtype">int</span> optStringLen;
<a name="l00750"></a>00750             <span class="keywordtype">int</span> thisopt;
<a name="l00751"></a>00751 
<a name="l00752"></a>00752 <span class="comment">/*@-sizeoftype@*/</span>
<a name="l00753"></a>00753             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a> &amp;&amp; <a class="code" href="poptint_8h.html#8606b44323c6450c9efe9ca1fb6b07c6">PBM_ISSET</a>(con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a>, con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a>)) {
<a name="l00754"></a>00754                 con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a>++;
<a name="l00755"></a>00755                 <span class="keywordflow">continue</span>;
<a name="l00756"></a>00756             }
<a name="l00757"></a>00757 <span class="comment">/*@=sizeoftype@*/</span>
<a name="l00758"></a>00758             thisopt = con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a>;
<a name="l00759"></a>00759             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a> != NULL)  <span class="comment">/* XXX can't happen */</span>
<a name="l00760"></a>00760             origOptString = con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>[con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a>++];
<a name="l00761"></a>00761 
<a name="l00762"></a>00762             <span class="keywordflow">if</span> (origOptString == NULL)  <span class="comment">/* XXX can't happen */</span>
<a name="l00763"></a>00763                 <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#1cbcee08db205a37789f81ec02234def">POPT_ERROR_BADOPT</a>;
<a name="l00764"></a>00764 
<a name="l00765"></a>00765             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#be76dfc76f4a31852dafd07ae0361537">restLeftover</a> || *origOptString != <span class="charliteral">'-'</span> ||
<a name="l00766"></a>00766                 (*origOptString == <span class="charliteral">'-'</span> &amp;&amp; origOptString[1] == <span class="charliteral">'\0'</span>))
<a name="l00767"></a>00767             {
<a name="l00768"></a>00768                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#0d532e7d187d8fd54b9de229ea1a51c4">flags</a> &amp; <a class="code" href="popt_8h.html#e980ab2ac9b1a95c96adf247edaaf3c0">POPT_CONTEXT_POSIXMEHARDER</a>)
<a name="l00769"></a>00769                     con-&gt;<a class="code" href="structpoptContext__s.html#be76dfc76f4a31852dafd07ae0361537">restLeftover</a> = 1;
<a name="l00770"></a>00770                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#0d532e7d187d8fd54b9de229ea1a51c4">flags</a> &amp; <a class="code" href="popt_8h.html#57d707b3107331d44b0f5ac1f0855de3">POPT_CONTEXT_ARG_OPTS</a>) {
<a name="l00771"></a>00771                     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> = <a class="code" href="system_8h.html#b62344482c6d93843e0388d2ba2cf514">xstrdup</a>(origOptString);
<a name="l00772"></a>00772                     <span class="keywordflow">return</span> 0;
<a name="l00773"></a>00773                 }
<a name="l00774"></a>00774                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a> != NULL)     <span class="comment">/* XXX can't happen */</span>
<a name="l00775"></a>00775                     con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a>[con-&gt;<a class="code" href="structpoptContext__s.html#a7a13994df6f103d61fed3bd5bada6e2">numLeftovers</a>++] = origOptString;
<a name="l00776"></a>00776                 <span class="keywordflow">continue</span>;
<a name="l00777"></a>00777             }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779             <span class="comment">/* Make a copy we can hack at */</span>
<a name="l00780"></a>00780             optString = origOptString;
<a name="l00781"></a>00781 
<a name="l00782"></a>00782             <span class="keywordflow">if</span> (optString[0] == <span class="charliteral">'\0'</span>)
<a name="l00783"></a>00783                 <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#1cbcee08db205a37789f81ec02234def">POPT_ERROR_BADOPT</a>;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785             <span class="keywordflow">if</span> (optString[1] == <span class="charliteral">'-'</span> &amp;&amp; !optString[2]) {
<a name="l00786"></a>00786                 con-&gt;<a class="code" href="structpoptContext__s.html#be76dfc76f4a31852dafd07ae0361537">restLeftover</a> = 1;
<a name="l00787"></a>00787                 <span class="keywordflow">continue</span>;
<a name="l00788"></a>00788             } <span class="keywordflow">else</span> {
<a name="l00789"></a>00789                 <span class="keyword">const</span> <span class="keywordtype">char</span> *oe;
<a name="l00790"></a>00790                 <span class="keywordtype">int</span> singleDash;
<a name="l00791"></a>00791 
<a name="l00792"></a>00792                 optString++;
<a name="l00793"></a>00793                 <span class="keywordflow">if</span> (*optString == <span class="charliteral">'-'</span>)
<a name="l00794"></a>00794                     singleDash = 0, optString++;
<a name="l00795"></a>00795                 <span class="keywordflow">else</span>
<a name="l00796"></a>00796                     singleDash = 1;
<a name="l00797"></a>00797 
<a name="l00798"></a>00798                 <span class="comment">/* XXX aliases with arg substitution need "--alias=arg" */</span>
<a name="l00799"></a>00799                 <span class="keywordflow">if</span> (<a class="code" href="popt_8c.html#93487bfde496e3fb01b1441039d55d09">handleAlias</a>(con, optString, <span class="charliteral">'\0'</span>, NULL))
<a name="l00800"></a>00800                     <span class="keywordflow">continue</span>;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802                 <span class="keywordflow">if</span> (<a class="code" href="popt_8c.html#44cac0f7730e758ed146538e33cf2226">handleExec</a>(con, optString, <span class="charliteral">'\0'</span>))
<a name="l00803"></a>00803                     <span class="keywordflow">continue</span>;
<a name="l00804"></a>00804 
<a name="l00805"></a>00805                 <span class="comment">/* Check for "--long=arg" option. */</span>
<a name="l00806"></a>00806                 <span class="keywordflow">for</span> (oe = optString; *oe &amp;&amp; *oe != <span class="charliteral">'='</span>; oe++)
<a name="l00807"></a>00807                     {};
<a name="l00808"></a>00808                 optStringLen = oe - optString;
<a name="l00809"></a>00809                 <span class="keywordflow">if</span> (*oe == <span class="charliteral">'='</span>)
<a name="l00810"></a>00810                     longArg = oe + 1;
<a name="l00811"></a>00811 
<a name="l00812"></a>00812                 opt = <a class="code" href="popt_8c.html#cdacf20be5b64c006416bdd6e71b5b3e">findOption</a>(con-&gt;<a class="code" href="structpoptContext__s.html#dad9df807e74fca28fae63d26a2f01b2">options</a>, optString, optStringLen, <span class="charliteral">'\0'</span>, &amp;cb, &amp;cbData,
<a name="l00813"></a>00813                                  singleDash);
<a name="l00814"></a>00814                 <span class="keywordflow">if</span> (!opt &amp;&amp; !singleDash)
<a name="l00815"></a>00815                     <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#1cbcee08db205a37789f81ec02234def">POPT_ERROR_BADOPT</a>;
<a name="l00816"></a>00816             }
<a name="l00817"></a>00817 
<a name="l00818"></a>00818             <span class="keywordflow">if</span> (!opt) {
<a name="l00819"></a>00819                 con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a> = origOptString + 1;
<a name="l00820"></a>00820             } <span class="keywordflow">else</span> {
<a name="l00821"></a>00821                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a> == con-&gt;<a class="code" href="structpoptContext__s.html#fb4fe00e407510f15c15de9bcdcc9a03">optionStack</a> &amp;&amp;
<a name="l00822"></a>00822                    opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#44bc305e1293c4a5fd1e6340cb9e27fa">POPT_ARGFLAG_STRIP</a>)
<a name="l00823"></a>00823                 {
<a name="l00824"></a>00824                     canstrip = 1;
<a name="l00825"></a>00825                     <a class="code" href="popt_8c.html#e4224d02aba0c3419d25658c9f180011">poptStripArg</a>(con, thisopt);
<a name="l00826"></a>00826                 }
<a name="l00827"></a>00827                 shorty = 0;
<a name="l00828"></a>00828             }
<a name="l00829"></a>00829         }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831         <span class="comment">/* Process next short option */</span>
<a name="l00832"></a>00832         <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a>) {
<a name="l00833"></a>00833             origOptString = con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a>;
<a name="l00834"></a>00834 
<a name="l00835"></a>00835             con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a> = NULL;
<a name="l00836"></a>00836 
<a name="l00837"></a>00837             <span class="keywordflow">if</span> (<a class="code" href="popt_8c.html#93487bfde496e3fb01b1441039d55d09">handleAlias</a>(con, NULL, *origOptString, origOptString + 1))
<a name="l00838"></a>00838                 <span class="keywordflow">continue</span>;
<a name="l00839"></a>00839 
<a name="l00840"></a>00840             <span class="keywordflow">if</span> (<a class="code" href="popt_8c.html#44cac0f7730e758ed146538e33cf2226">handleExec</a>(con, NULL, *origOptString)) {
<a name="l00841"></a>00841                 <span class="comment">/* Restore rest of short options for further processing */</span>
<a name="l00842"></a>00842                 origOptString++;
<a name="l00843"></a>00843                 <span class="keywordflow">if</span> (*origOptString != <span class="charliteral">'\0'</span>)
<a name="l00844"></a>00844                     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a> = origOptString;
<a name="l00845"></a>00845                 <span class="keywordflow">continue</span>;
<a name="l00846"></a>00846             }
<a name="l00847"></a>00847 
<a name="l00848"></a>00848             opt = <a class="code" href="popt_8c.html#cdacf20be5b64c006416bdd6e71b5b3e">findOption</a>(con-&gt;<a class="code" href="structpoptContext__s.html#dad9df807e74fca28fae63d26a2f01b2">options</a>, NULL, 0, *origOptString, &amp;cb,
<a name="l00849"></a>00849                              &amp;cbData, 0);
<a name="l00850"></a>00850             <span class="keywordflow">if</span> (!opt)
<a name="l00851"></a>00851                 <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#1cbcee08db205a37789f81ec02234def">POPT_ERROR_BADOPT</a>;
<a name="l00852"></a>00852             shorty = 1;
<a name="l00853"></a>00853 
<a name="l00854"></a>00854             origOptString++;
<a name="l00855"></a>00855             <span class="keywordflow">if</span> (*origOptString != <span class="charliteral">'\0'</span>)
<a name="l00856"></a>00856                 con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a> = origOptString;
<a name="l00857"></a>00857         }
<a name="l00858"></a>00858 
<a name="l00859"></a>00859         <span class="keywordflow">if</span> (opt == NULL) <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#1cbcee08db205a37789f81ec02234def">POPT_ERROR_BADOPT</a>;      <span class="comment">/* XXX can't happen */</span>
<a name="l00860"></a>00860         <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a> &amp;&amp; (opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a>) {
<a name="l00861"></a>00861             <span class="keywordflow">if</span> (<a class="code" href="popt_8c.html#24b052439c4a11b96b9834ba34c35402" title="Save an integer, performing logical operation with value.">poptSaveInt</a>((<span class="keywordtype">int</span> *)opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>, opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a>, 1L))
<a name="l00862"></a>00862                 <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#7075a89582a670d9ea2a1c16e3412faf">POPT_ERROR_BADOPERATION</a>;
<a name="l00863"></a>00863         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#3cce9e5474e0828f7a87dca5b2c4a4f9">POPT_ARG_VAL</a>) {
<a name="l00864"></a>00864             <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>) {
<a name="l00865"></a>00865                 <span class="keywordflow">if</span> (<a class="code" href="popt_8c.html#24b052439c4a11b96b9834ba34c35402" title="Save an integer, performing logical operation with value.">poptSaveInt</a>((<span class="keywordtype">int</span> *)opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>, opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a>, (<span class="keywordtype">long</span>)opt-&gt;<a class="code" href="structpoptOption.html#a6a9c91f5c1869870c3b872395e2b625">val</a>))
<a name="l00866"></a>00866                     <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#7075a89582a670d9ea2a1c16e3412faf">POPT_ERROR_BADOPERATION</a>;
<a name="l00867"></a>00867             }
<a name="l00868"></a>00868         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) != <a class="code" href="popt_8h.html#7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a>) {
<a name="l00869"></a>00869             con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a>);
<a name="l00870"></a>00870             <span class="keywordflow">if</span> (longArg) {
<a name="l00871"></a>00871                 longArg = <a class="code" href="popt_8c.html#36adc119ee9adb494f2bf10212ccd899">expandNextArg</a>(con, longArg);
<a name="l00872"></a>00872                 con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> = (<span class="keywordtype">char</span> *) longArg;
<a name="l00873"></a>00873             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a>) {
<a name="l00874"></a>00874                 longArg = <a class="code" href="popt_8c.html#36adc119ee9adb494f2bf10212ccd899">expandNextArg</a>(con, con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a>);
<a name="l00875"></a>00875                 con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> = (<span class="keywordtype">char</span> *) longArg;
<a name="l00876"></a>00876                 con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a> = NULL;
<a name="l00877"></a>00877             } <span class="keywordflow">else</span> {
<a name="l00878"></a>00878                 <span class="keywordflow">while</span> (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a> == con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a> &amp;&amp;
<a name="l00879"></a>00879                        con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a> &gt; con-&gt;<a class="code" href="structpoptContext__s.html#fb4fe00e407510f15c15de9bcdcc9a03">optionStack</a>) {
<a name="l00880"></a>00880                     <a class="code" href="popt_8c.html#9fdab699d4f5021e1507fecc87a1363f">cleanOSE</a>(con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>--);
<a name="l00881"></a>00881                 }
<a name="l00882"></a>00882                 <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a> == con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a>) {
<a name="l00883"></a>00883                     <span class="keywordflow">if</span> (!(opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#d57706398ba6fc6b15e4a45e1bf56616">POPT_ARGFLAG_OPTIONAL</a>))
<a name="l00884"></a>00884                         <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#28bb1cf1823622c3510d2976da33ad06">POPT_ERROR_NOARG</a>;
<a name="l00885"></a>00885                     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> = NULL;
<a name="l00886"></a>00886                 } <span class="keywordflow">else</span> {
<a name="l00887"></a>00887 
<a name="l00888"></a>00888                     <span class="comment">/*</span>
<a name="l00889"></a>00889 <span class="comment">                     * Make sure this isn't part of a short arg or the</span>
<a name="l00890"></a>00890 <span class="comment">                     * result of an alias expansion.</span>
<a name="l00891"></a>00891 <span class="comment">                     */</span>
<a name="l00892"></a>00892                     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a> == con-&gt;<a class="code" href="structpoptContext__s.html#fb4fe00e407510f15c15de9bcdcc9a03">optionStack</a> &amp;&amp;
<a name="l00893"></a>00893                         (opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#44bc305e1293c4a5fd1e6340cb9e27fa">POPT_ARGFLAG_STRIP</a>) &amp;&amp;
<a name="l00894"></a>00894                         canstrip) {
<a name="l00895"></a>00895                         <a class="code" href="popt_8c.html#e4224d02aba0c3419d25658c9f180011">poptStripArg</a>(con, con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a>);
<a name="l00896"></a>00896                     }
<a name="l00897"></a>00897                 
<a name="l00898"></a>00898                     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a> != NULL) {        <span class="comment">/* XXX can't happen */</span>
<a name="l00899"></a>00899                         <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#d57706398ba6fc6b15e4a45e1bf56616">POPT_ARGFLAG_OPTIONAL</a> &amp;&amp;
<a name="l00900"></a>00900                             con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>[con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a>][0] == <span class="charliteral">'-'</span>) {
<a name="l00901"></a>00901                             con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> = NULL;
<a name="l00902"></a>00902                         } <span class="keywordflow">else</span> {
<a name="l00903"></a>00903                             <span class="comment">/* XXX watchout: subtle side-effects live here. */</span>
<a name="l00904"></a>00904                             longArg = con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>[con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a>++];
<a name="l00905"></a>00905                             longArg = <a class="code" href="popt_8c.html#36adc119ee9adb494f2bf10212ccd899">expandNextArg</a>(con, longArg);
<a name="l00906"></a>00906                             con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> = (<span class="keywordtype">char</span> *) longArg;
<a name="l00907"></a>00907                         }
<a name="l00908"></a>00908                     }
<a name="l00909"></a>00909                 }
<a name="l00910"></a>00910             }
<a name="l00911"></a>00911             longArg = NULL;
<a name="l00912"></a>00912 
<a name="l00913"></a>00913             <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>) {
<a name="l00914"></a>00914                 <span class="keywordflow">switch</span> (opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) {
<a name="l00915"></a>00915                 <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#9a9fdc308379d49592585008126c28b1">POPT_ARG_STRING</a>:
<a name="l00916"></a>00916                     <span class="comment">/* XXX memory leak, hard to plug */</span>
<a name="l00917"></a>00917                     *((<span class="keyword">const</span> <span class="keywordtype">char</span> **) opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>) = (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a>)
<a name="l00918"></a>00918                         ? <a class="code" href="system_8h.html#b62344482c6d93843e0388d2ba2cf514">xstrdup</a>(con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a>) : NULL;
<a name="l00919"></a>00919                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00920"></a>00920 
<a name="l00921"></a>00921                 <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#6b2e43ed233939be1eab7e9afd66db58">POPT_ARG_INT</a>:
<a name="l00922"></a>00922                 <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#77102c8def672e74e946f7d2978aca76">POPT_ARG_LONG</a>:
<a name="l00923"></a>00923                 {   <span class="keywordtype">long</span> aLong = 0;
<a name="l00924"></a>00924                     <span class="keywordtype">char</span> *end;
<a name="l00925"></a>00925 
<a name="l00926"></a>00926                     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a>) {
<a name="l00927"></a>00927                         aLong = strtol(con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a>, &amp;end, 0);
<a name="l00928"></a>00928                         <span class="keywordflow">if</span> (!(end &amp;&amp; *end == <span class="charliteral">'\0'</span>))
<a name="l00929"></a>00929                             <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#ef2d07c24d3a76d6dda5725be37b53c6">POPT_ERROR_BADNUMBER</a>;
<a name="l00930"></a>00930                     }
<a name="l00931"></a>00931 
<a name="l00932"></a>00932                     <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#77102c8def672e74e946f7d2978aca76">POPT_ARG_LONG</a>) {
<a name="l00933"></a>00933                         <span class="keywordflow">if</span> (aLong == LONG_MIN || aLong == LONG_MAX)
<a name="l00934"></a>00934                             <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#0627349bf2956429e33e4f45e475b255">POPT_ERROR_OVERFLOW</a>;
<a name="l00935"></a>00935                         <span class="keywordflow">if</span> (<a class="code" href="popt_8c.html#d5a5b29113defd6974d9a6e30a4ec3ad" title="Save a long, performing logical operation with value.">poptSaveLong</a>((<span class="keywordtype">long</span> *)opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>, opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a>, aLong))
<a name="l00936"></a>00936                             <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#7075a89582a670d9ea2a1c16e3412faf">POPT_ERROR_BADOPERATION</a>;
<a name="l00937"></a>00937                     } <span class="keywordflow">else</span> {
<a name="l00938"></a>00938                         <span class="keywordflow">if</span> (aLong &gt; INT_MAX || aLong &lt; INT_MIN)
<a name="l00939"></a>00939                             <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#0627349bf2956429e33e4f45e475b255">POPT_ERROR_OVERFLOW</a>;
<a name="l00940"></a>00940                         <span class="keywordflow">if</span> (<a class="code" href="popt_8c.html#24b052439c4a11b96b9834ba34c35402" title="Save an integer, performing logical operation with value.">poptSaveInt</a>((<span class="keywordtype">int</span> *)opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>, opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a>, aLong))
<a name="l00941"></a>00941                             <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#7075a89582a670d9ea2a1c16e3412faf">POPT_ERROR_BADOPERATION</a>;
<a name="l00942"></a>00942                     }
<a name="l00943"></a>00943                 }   <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00944"></a>00944 
<a name="l00945"></a>00945                 <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#613f45421206fbe405d59c15c860a1ce">POPT_ARG_FLOAT</a>:
<a name="l00946"></a>00946                 <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#1057bde1197132ed933630391f1898b9">POPT_ARG_DOUBLE</a>:
<a name="l00947"></a>00947                 {   <span class="keywordtype">double</span> aDouble = 0.0;
<a name="l00948"></a>00948                     <span class="keywordtype">char</span> *end;
<a name="l00949"></a>00949 
<a name="l00950"></a>00950                     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a>) {
<a name="l00951"></a>00951 <span class="comment">/*@-mods@*/</span>
<a name="l00952"></a>00952                         <span class="keywordtype">int</span> saveerrno = errno;
<a name="l00953"></a>00953                         errno = 0;
<a name="l00954"></a>00954                         aDouble = strtod(con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a>, &amp;end);
<a name="l00955"></a>00955                         <span class="keywordflow">if</span> (errno == ERANGE)
<a name="l00956"></a>00956                             <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#0627349bf2956429e33e4f45e475b255">POPT_ERROR_OVERFLOW</a>;
<a name="l00957"></a>00957                         errno = saveerrno;
<a name="l00958"></a>00958 <span class="comment">/*@=mods@*/</span>
<a name="l00959"></a>00959                         <span class="keywordflow">if</span> (*end != <span class="charliteral">'\0'</span>)
<a name="l00960"></a>00960                             <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#ef2d07c24d3a76d6dda5725be37b53c6">POPT_ERROR_BADNUMBER</a>;
<a name="l00961"></a>00961                     }
<a name="l00962"></a>00962 
<a name="l00963"></a>00963                     <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#1057bde1197132ed933630391f1898b9">POPT_ARG_DOUBLE</a>) {
<a name="l00964"></a>00964                         *((<span class="keywordtype">double</span> *) opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>) = aDouble;
<a name="l00965"></a>00965                     } <span class="keywordflow">else</span> {
<a name="l00966"></a>00966 <span class="preprocessor">#define _ABS(a) ((((a) - 0.0) &lt; DBL_EPSILON) ? -(a) : (a))</span>
<a name="l00967"></a>00967 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> ((<a class="code" href="popt_8c.html#97d52c4c962a45d82d5a60ebb9ef56b9">_ABS</a>(aDouble) - FLT_MAX) &gt; DBL_EPSILON)
<a name="l00968"></a>00968                             <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#0627349bf2956429e33e4f45e475b255">POPT_ERROR_OVERFLOW</a>;
<a name="l00969"></a>00969                         <span class="keywordflow">if</span> ((FLT_MIN - <a class="code" href="popt_8c.html#97d52c4c962a45d82d5a60ebb9ef56b9">_ABS</a>(aDouble)) &gt; DBL_EPSILON)
<a name="l00970"></a>00970                             <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#0627349bf2956429e33e4f45e475b255">POPT_ERROR_OVERFLOW</a>;
<a name="l00971"></a>00971                         *((<span class="keywordtype">float</span> *) opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>) = aDouble;
<a name="l00972"></a>00972                     }
<a name="l00973"></a>00973                 }   <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00974"></a>00974                 <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#4dfb8f93a55df0fc7e8a0493874fdaae">POPT_ARG_MAINCALL</a>:
<a name="l00975"></a>00975 <span class="comment">/*@-type@*/</span>
<a name="l00976"></a>00976                     con-&gt;<a class="code" href="structpoptContext__s.html#e5dcf300c4e97d37d9977ef507d48fb2">maincall</a> = opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>;
<a name="l00977"></a>00977 <span class="comment">/*@=type@*/</span>
<a name="l00978"></a>00978                     <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00979"></a>00979                 <span class="keywordflow">default</span>:
<a name="l00980"></a>00980                     fprintf(stdout,
<a name="l00981"></a>00981                         <a class="code" href="poptint_8h.html#0c20a067634485b9c68ad5dfe83729d2">POPT_</a>(<span class="stringliteral">"option type (%d) not implemented in popt\n"</span>),
<a name="l00982"></a>00982                         (opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>));
<a name="l00983"></a>00983                     exit(EXIT_FAILURE);
<a name="l00984"></a>00984                     <span class="comment">/*@notreached@*/</span> <span class="comment">/*@switchbreak@*/</span> <span class="keywordflow">break</span>;
<a name="l00985"></a>00985                 }
<a name="l00986"></a>00986             }
<a name="l00987"></a>00987         }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989         <span class="keywordflow">if</span> (cb)
<a name="l00990"></a>00990             <a class="code" href="popt_8c.html#635149a20667bb61c5ef14a5a567d9ec">invokeCallbacksOPTION</a>(con, con-&gt;<a class="code" href="structpoptContext__s.html#dad9df807e74fca28fae63d26a2f01b2">options</a>, opt, cbData, shorty);
<a name="l00991"></a>00991         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="structpoptOption.html#a6a9c91f5c1869870c3b872395e2b625">val</a> &amp;&amp; ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) != <a class="code" href="popt_8h.html#3cce9e5474e0828f7a87dca5b2c4a4f9">POPT_ARG_VAL</a>))
<a name="l00992"></a>00992             done = 1;
<a name="l00993"></a>00993 
<a name="l00994"></a>00994         <span class="keywordflow">if</span> ((con-&gt;<a class="code" href="structpoptContext__s.html#0c5a151e184bf3996af518c7c1a9fdbd">finalArgvCount</a> + 2) &gt;= (con-&gt;<a class="code" href="structpoptContext__s.html#22873bd65778f6f1bfb1d4bc5d827bf4">finalArgvAlloced</a>)) {
<a name="l00995"></a>00995             con-&gt;<a class="code" href="structpoptContext__s.html#22873bd65778f6f1bfb1d4bc5d827bf4">finalArgvAlloced</a> += 10;
<a name="l00996"></a>00996             con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a> = realloc(con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>,
<a name="l00997"></a>00997                             <span class="keyword">sizeof</span>(*con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>) * con-&gt;<a class="code" href="structpoptContext__s.html#22873bd65778f6f1bfb1d4bc5d827bf4">finalArgvAlloced</a>);
<a name="l00998"></a>00998         }
<a name="l00999"></a>00999 
<a name="l01000"></a>01000         <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a> != NULL)
<a name="l01001"></a>01001         {   <span class="keywordtype">char</span> *s = malloc((opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> ? strlen(opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>) : 0) + 3);
<a name="l01002"></a>01002             <span class="keywordflow">if</span> (s != NULL) {    <span class="comment">/* XXX can't happen */</span>
<a name="l01003"></a>01003                 <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>)
<a name="l01004"></a>01004                     sprintf(s, <span class="stringliteral">"%s%s"</span>,
<a name="l01005"></a>01005                         ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#5f59cf9e70e26f26b82161e0ce2b4741">POPT_ARGFLAG_ONEDASH</a>) ? <span class="stringliteral">"-"</span> : <span class="stringliteral">"--"</span>),
<a name="l01006"></a>01006                         opt-&gt;<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>);
<a name="l01007"></a>01007                 <span class="keywordflow">else</span>
<a name="l01008"></a>01008                     sprintf(s, <span class="stringliteral">"-%c"</span>, opt-&gt;<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a>);
<a name="l01009"></a>01009                 con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>[con-&gt;<a class="code" href="structpoptContext__s.html#0c5a151e184bf3996af518c7c1a9fdbd">finalArgvCount</a>++] = s;
<a name="l01010"></a>01010             } <span class="keywordflow">else</span>
<a name="l01011"></a>01011                 con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>[con-&gt;<a class="code" href="structpoptContext__s.html#0c5a151e184bf3996af518c7c1a9fdbd">finalArgvCount</a>++] = NULL;
<a name="l01012"></a>01012         }
<a name="l01013"></a>01013 
<a name="l01014"></a>01014         <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a> &amp;&amp; (opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a>)
<a name="l01015"></a>01015             <span class="comment">/*@-ifempty@*/</span> ; <span class="comment">/*@=ifempty@*/</span>
<a name="l01016"></a>01016         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) == <a class="code" href="popt_8h.html#3cce9e5474e0828f7a87dca5b2c4a4f9">POPT_ARG_VAL</a>)
<a name="l01017"></a>01017             <span class="comment">/*@-ifempty@*/</span> ; <span class="comment">/*@=ifempty@*/</span>
<a name="l01018"></a>01018         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((opt-&gt;<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> &amp; <a class="code" href="popt_8h.html#07b02da310d6960044daf44a0d8279d6">POPT_ARG_MASK</a>) != <a class="code" href="popt_8h.html#7759fe17e59c7fb08d33984d4683e4c0">POPT_ARG_NONE</a>) {
<a name="l01019"></a>01019             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a> != NULL &amp;&amp; con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> != NULL)
<a name="l01020"></a>01020                 con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>[con-&gt;<a class="code" href="structpoptContext__s.html#0c5a151e184bf3996af518c7c1a9fdbd">finalArgvCount</a>++] =
<a name="l01021"></a>01021                         <a class="code" href="system_8h.html#b62344482c6d93843e0388d2ba2cf514">xstrdup</a>(con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a>);
<a name="l01022"></a>01022         }
<a name="l01023"></a>01023     }
<a name="l01024"></a>01024 
<a name="l01025"></a>01025     <span class="keywordflow">return</span> (opt ? opt-&gt;<a class="code" href="structpoptOption.html#a6a9c91f5c1869870c3b872395e2b625">val</a> : -1);       <span class="comment">/* XXX can't happen */</span>
<a name="l01026"></a>01026 }
<a name="l01027"></a>01027 
<a name="l01028"></a><a class="code" href="popt_8h.html#22ce0f0df66fd9c46cbeb43b56b1d545">01028</a> <span class="keywordtype">char</span> * <a class="code" href="popt_8c.html#22ce0f0df66fd9c46cbeb43b56b1d545" title="Return next option argument (if any).">poptGetOptArg</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con)
<a name="l01029"></a>01029 {
<a name="l01030"></a>01030     <span class="keywordtype">char</span> * ret = NULL;
<a name="l01031"></a>01031     <span class="keywordflow">if</span> (con) {
<a name="l01032"></a>01032         ret = con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a>;
<a name="l01033"></a>01033         con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> = NULL;
<a name="l01034"></a>01034     }
<a name="l01035"></a>01035     <span class="keywordflow">return</span> ret;
<a name="l01036"></a>01036 }
<a name="l01037"></a>01037 
<a name="l01038"></a><a class="code" href="popt_8h.html#d2ddb3b4a87ccdf0c56cafd8355091f3">01038</a> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="popt_8c.html#d2ddb3b4a87ccdf0c56cafd8355091f3" title="Return next argument.">poptGetArg</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con)
<a name="l01039"></a>01039 {
<a name="l01040"></a>01040     <span class="keyword">const</span> <span class="keywordtype">char</span> * ret = NULL;
<a name="l01041"></a>01041     <span class="keywordflow">if</span> (con &amp;&amp; con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a> != NULL &amp;&amp; con-&gt;<a class="code" href="structpoptContext__s.html#217a5349eaed3f52683f2b8fa751e3e0">nextLeftover</a> &lt; con-&gt;<a class="code" href="structpoptContext__s.html#a7a13994df6f103d61fed3bd5bada6e2">numLeftovers</a>)
<a name="l01042"></a>01042         ret = con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a>[con-&gt;<a class="code" href="structpoptContext__s.html#217a5349eaed3f52683f2b8fa751e3e0">nextLeftover</a>++];
<a name="l01043"></a>01043     <span class="keywordflow">return</span> ret;
<a name="l01044"></a>01044 }
<a name="l01045"></a>01045 
<a name="l01046"></a><a class="code" href="popt_8h.html#12b20d85bfc463a9ac2573772d65d19d">01046</a> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="popt_8c.html#12b20d85bfc463a9ac2573772d65d19d" title="Peek at current argument.">poptPeekArg</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con)
<a name="l01047"></a>01047 {
<a name="l01048"></a>01048     <span class="keyword">const</span> <span class="keywordtype">char</span> * ret = NULL;
<a name="l01049"></a>01049     <span class="keywordflow">if</span> (con &amp;&amp; con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a> != NULL &amp;&amp; con-&gt;<a class="code" href="structpoptContext__s.html#217a5349eaed3f52683f2b8fa751e3e0">nextLeftover</a> &lt; con-&gt;<a class="code" href="structpoptContext__s.html#a7a13994df6f103d61fed3bd5bada6e2">numLeftovers</a>)
<a name="l01050"></a>01050         ret = con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a>[con-&gt;<a class="code" href="structpoptContext__s.html#217a5349eaed3f52683f2b8fa751e3e0">nextLeftover</a>];
<a name="l01051"></a>01051     <span class="keywordflow">return</span> ret;
<a name="l01052"></a>01052 }
<a name="l01053"></a>01053 
<a name="l01054"></a><a class="code" href="popt_8h.html#3c55cea59bcf29ee9da7b95127c48c83">01054</a> <span class="keyword">const</span> <span class="keywordtype">char</span> ** <a class="code" href="popt_8c.html#3c55cea59bcf29ee9da7b95127c48c83" title="Return remaining arguments.">poptGetArgs</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con)
<a name="l01055"></a>01055 {
<a name="l01056"></a>01056     <span class="keywordflow">if</span> (con == NULL ||
<a name="l01057"></a>01057         con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a> == NULL || con-&gt;<a class="code" href="structpoptContext__s.html#a7a13994df6f103d61fed3bd5bada6e2">numLeftovers</a> == con-&gt;<a class="code" href="structpoptContext__s.html#217a5349eaed3f52683f2b8fa751e3e0">nextLeftover</a>)
<a name="l01058"></a>01058         <span class="keywordflow">return</span> NULL;
<a name="l01059"></a>01059 
<a name="l01060"></a>01060     <span class="comment">/* some apps like [like RPM ;-) ] need this NULL terminated */</span>
<a name="l01061"></a>01061     con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a>[con-&gt;<a class="code" href="structpoptContext__s.html#a7a13994df6f103d61fed3bd5bada6e2">numLeftovers</a>] = NULL;
<a name="l01062"></a>01062 
<a name="l01063"></a>01063 <span class="comment">/*@-nullret -nullstate @*/</span>      <span class="comment">/* FIX: typedef double indirection. */</span>
<a name="l01064"></a>01064     <span class="keywordflow">return</span> (con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a> + con-&gt;<a class="code" href="structpoptContext__s.html#217a5349eaed3f52683f2b8fa751e3e0">nextLeftover</a>);
<a name="l01065"></a>01065 <span class="comment">/*@=nullret =nullstate @*/</span>
<a name="l01066"></a>01066 }
<a name="l01067"></a>01067 
<a name="l01068"></a><a class="code" href="popt_8h.html#cacbdcde9b4c5600176b37ffb06224a3">01068</a> <a class="code" href="structpoptContext__s.html">poptContext</a> <a class="code" href="popt_8c.html#cacbdcde9b4c5600176b37ffb06224a3" title="Destroy context.">poptFreeContext</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con)
<a name="l01069"></a>01069 {
<a name="l01070"></a>01070     <a class="code" href="structpoptItem__s.html" title="A popt alias or exec argument for poptAddItem().">poptItem</a> item;
<a name="l01071"></a>01071     <span class="keywordtype">int</span> i;
<a name="l01072"></a>01072 
<a name="l01073"></a>01073     <span class="keywordflow">if</span> (con == NULL) <span class="keywordflow">return</span> con;
<a name="l01074"></a>01074     <a class="code" href="popt_8c.html#66e307ed79a41a4b8880e0b06f04414b" title="Reinitialize popt context.">poptResetContext</a>(con);
<a name="l01075"></a>01075     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a>);
<a name="l01076"></a>01076 
<a name="l01077"></a>01077     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#03cc608197cd1897d1228aef0d8bf61d">aliases</a> != NULL)
<a name="l01078"></a>01078     <span class="keywordflow">for</span> (i = 0; i &lt; con-&gt;<a class="code" href="structpoptContext__s.html#fb0ace2c6600299043a3ec8a922bc820">numAliases</a>; i++) {
<a name="l01079"></a>01079         item = con-&gt;<a class="code" href="structpoptContext__s.html#03cc608197cd1897d1228aef0d8bf61d">aliases</a> + i;
<a name="l01080"></a>01080 <span class="comment">/*@-modobserver -observertrans -dependenttrans@*/</span>
<a name="l01081"></a>01081         item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>);
<a name="l01082"></a>01082         item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#d0123e0f28a19468eb34e89753064745">descrip</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#d0123e0f28a19468eb34e89753064745">descrip</a>);
<a name="l01083"></a>01083         item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#a0eff46a712ca64ea3103be9f73f4373">argDescrip</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#a0eff46a712ca64ea3103be9f73f4373">argDescrip</a>);
<a name="l01084"></a>01084 <span class="comment">/*@=modobserver =observertrans =dependenttrans@*/</span>
<a name="l01085"></a>01085         item-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(item-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a>);
<a name="l01086"></a>01086     }
<a name="l01087"></a>01087     con-&gt;<a class="code" href="structpoptContext__s.html#03cc608197cd1897d1228aef0d8bf61d">aliases</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(con-&gt;<a class="code" href="structpoptContext__s.html#03cc608197cd1897d1228aef0d8bf61d">aliases</a>);
<a name="l01088"></a>01088 
<a name="l01089"></a>01089     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#17343ec6b740a3ac2066cf8d99488005">execs</a> != NULL)
<a name="l01090"></a>01090     <span class="keywordflow">for</span> (i = 0; i &lt; con-&gt;<a class="code" href="structpoptContext__s.html#57cfdc604ad6e3ff739c0d8d3a0e818a">numExecs</a>; i++) {
<a name="l01091"></a>01091         item = con-&gt;<a class="code" href="structpoptContext__s.html#17343ec6b740a3ac2066cf8d99488005">execs</a> + i;
<a name="l01092"></a>01092 <span class="comment">/*@-modobserver -observertrans -dependenttrans@*/</span>
<a name="l01093"></a>01093         item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>);
<a name="l01094"></a>01094         item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#d0123e0f28a19468eb34e89753064745">descrip</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#d0123e0f28a19468eb34e89753064745">descrip</a>);
<a name="l01095"></a>01095         item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#a0eff46a712ca64ea3103be9f73f4373">argDescrip</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#a0eff46a712ca64ea3103be9f73f4373">argDescrip</a>);
<a name="l01096"></a>01096 <span class="comment">/*@=modobserver =observertrans =dependenttrans@*/</span>
<a name="l01097"></a>01097         item-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(item-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a>);
<a name="l01098"></a>01098     }
<a name="l01099"></a>01099     con-&gt;<a class="code" href="structpoptContext__s.html#17343ec6b740a3ac2066cf8d99488005">execs</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(con-&gt;<a class="code" href="structpoptContext__s.html#17343ec6b740a3ac2066cf8d99488005">execs</a>);
<a name="l01100"></a>01100 
<a name="l01101"></a>01101     con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(con-&gt;<a class="code" href="structpoptContext__s.html#132c28f3847ded144880e1b1ee4231a7">leftovers</a>);
<a name="l01102"></a>01102     con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(con-&gt;<a class="code" href="structpoptContext__s.html#e47d4963c1e3953b55aeec44895c0439">finalArgv</a>);
<a name="l01103"></a>01103     con-&gt;<a class="code" href="structpoptContext__s.html#afe275efe496fa1217d5d8dff6434aa9">appName</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(con-&gt;<a class="code" href="structpoptContext__s.html#afe275efe496fa1217d5d8dff6434aa9">appName</a>);
<a name="l01104"></a>01104     con-&gt;<a class="code" href="structpoptContext__s.html#6ea7478c290af28b37f850b2a3c75c19">otherHelp</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(con-&gt;<a class="code" href="structpoptContext__s.html#6ea7478c290af28b37f850b2a3c75c19">otherHelp</a>);
<a name="l01105"></a>01105     con-&gt;<a class="code" href="structpoptContext__s.html#3a8c9082b8dd21f720c24e492519971c">execPath</a> = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(con-&gt;<a class="code" href="structpoptContext__s.html#3a8c9082b8dd21f720c24e492519971c">execPath</a>);
<a name="l01106"></a>01106     con-&gt;<a class="code" href="structpoptContext__s.html#6b8f9e4e2175d16b8903243819318418">arg_strip</a> = <a class="code" href="poptint_8h.html#78689d45d1c852a2513fa04271495b0c">PBM_FREE</a>(con-&gt;<a class="code" href="structpoptContext__s.html#6b8f9e4e2175d16b8903243819318418">arg_strip</a>);
<a name="l01107"></a>01107     
<a name="l01108"></a>01108     con = <a class="code" href="poptint_8h.html#2574a8c557fe9a6754ff3b3656943f23" title="Wrapper to free(3), hides const compilation noise, permit NULL, return NULL.">_free</a>(con);
<a name="l01109"></a>01109     <span class="keywordflow">return</span> con;
<a name="l01110"></a>01110 }
<a name="l01111"></a>01111 
<a name="l01112"></a><a class="code" href="popt_8h.html#492540d74e36a084744b453388407ace">01112</a> <span class="keywordtype">int</span> <a class="code" href="popt_8c.html#492540d74e36a084744b453388407ace" title="Add alias to context.">poptAddAlias</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con, <span class="keyword">struct</span> <a class="code" href="structpoptAlias.html" title="A popt alias argument for poptAddAlias().">poptAlias</a> alias,
<a name="l01113"></a>01113                 <span class="comment">/*@unused@*/</span> <span class="keywordtype">int</span> flags)
<a name="l01114"></a>01114 {
<a name="l01115"></a>01115     <span class="keyword">struct </span><a class="code" href="structpoptItem__s.html" title="A popt alias or exec argument for poptAddItem().">poptItem_s</a> item_buf;
<a name="l01116"></a>01116     <a class="code" href="structpoptItem__s.html" title="A popt alias or exec argument for poptAddItem().">poptItem</a> item = &amp;item_buf;
<a name="l01117"></a>01117     memset(item, 0, <span class="keyword">sizeof</span>(*item));
<a name="l01118"></a>01118     item-&gt;option.longName = alias.<a class="code" href="structpoptAlias.html#92907c8fe8d1a61b281c21a4c724b7e6">longName</a>;
<a name="l01119"></a>01119     item-&gt;option.shortName = alias.<a class="code" href="structpoptAlias.html#cc11957cb38d95c51ef7ab5ef75ef7bf">shortName</a>;
<a name="l01120"></a>01120     item-&gt;option.argInfo = <a class="code" href="popt_8h.html#1f108633e1f7f983f4a5a478176dee4a">POPT_ARGFLAG_DOC_HIDDEN</a>;
<a name="l01121"></a>01121     item-&gt;option.arg = 0;
<a name="l01122"></a>01122     item-&gt;option.val = 0;
<a name="l01123"></a>01123     item-&gt;option.descrip = NULL;
<a name="l01124"></a>01124     item-&gt;option.argDescrip = NULL;
<a name="l01125"></a>01125     item-&gt;argc = alias.<a class="code" href="structpoptAlias.html#61d854f4dc7da46c44ec034b93f5968e">argc</a>;
<a name="l01126"></a>01126     item-&gt;argv = alias.<a class="code" href="structpoptAlias.html#80b40d2518a74014cf4dbbd5980e90a6">argv</a>;
<a name="l01127"></a>01127     <span class="keywordflow">return</span> <a class="code" href="popt_8c.html#5d5b852dd906dea5d13b5c9934242ea9" title="Add alias/exec item to context.">poptAddItem</a>(con, item, 0);
<a name="l01128"></a>01128 }
<a name="l01129"></a>01129 
<a name="l01130"></a><a class="code" href="popt_8h.html#5d5b852dd906dea5d13b5c9934242ea9">01130</a> <span class="keywordtype">int</span> <a class="code" href="popt_8c.html#5d5b852dd906dea5d13b5c9934242ea9" title="Add alias/exec item to context.">poptAddItem</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con, <a class="code" href="structpoptItem__s.html" title="A popt alias or exec argument for poptAddItem().">poptItem</a> newItem, <span class="keywordtype">int</span> flags)
<a name="l01131"></a>01131 {
<a name="l01132"></a>01132     <a class="code" href="structpoptItem__s.html" title="A popt alias or exec argument for poptAddItem().">poptItem</a> * items, item;
<a name="l01133"></a>01133     <span class="keywordtype">int</span> * nitems;
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     <span class="keywordflow">switch</span> (flags) {
<a name="l01136"></a>01136     <span class="keywordflow">case</span> 1:
<a name="l01137"></a>01137         items = &amp;con-&gt;<a class="code" href="structpoptContext__s.html#17343ec6b740a3ac2066cf8d99488005">execs</a>;
<a name="l01138"></a>01138         nitems = &amp;con-&gt;<a class="code" href="structpoptContext__s.html#57cfdc604ad6e3ff739c0d8d3a0e818a">numExecs</a>;
<a name="l01139"></a>01139         <span class="keywordflow">break</span>;
<a name="l01140"></a>01140     <span class="keywordflow">case</span> 0:
<a name="l01141"></a>01141         items = &amp;con-&gt;<a class="code" href="structpoptContext__s.html#03cc608197cd1897d1228aef0d8bf61d">aliases</a>;
<a name="l01142"></a>01142         nitems = &amp;con-&gt;<a class="code" href="structpoptContext__s.html#fb0ace2c6600299043a3ec8a922bc820">numAliases</a>;
<a name="l01143"></a>01143         <span class="keywordflow">break</span>;
<a name="l01144"></a>01144     <span class="keywordflow">default</span>:
<a name="l01145"></a>01145         <span class="keywordflow">return</span> 1;
<a name="l01146"></a>01146         <span class="comment">/*@notreached@*/</span> <span class="keywordflow">break</span>;
<a name="l01147"></a>01147     }
<a name="l01148"></a>01148 
<a name="l01149"></a>01149     *items = realloc((*items), ((*nitems) + 1) * <span class="keyword">sizeof</span>(**items));
<a name="l01150"></a>01150     <span class="keywordflow">if</span> ((*items) == NULL)
<a name="l01151"></a>01151         <span class="keywordflow">return</span> 1;
<a name="l01152"></a>01152 
<a name="l01153"></a>01153     item = (*items) + (*nitems);
<a name="l01154"></a>01154 
<a name="l01155"></a>01155     item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> =
<a name="l01156"></a>01156         (newItem-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a> ? <a class="code" href="system_8h.html#b62344482c6d93843e0388d2ba2cf514">xstrdup</a>(newItem-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#cb5681d547739c8417c87aabd7ca7a7f">longName</a>) : NULL);
<a name="l01157"></a>01157     item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a> = newItem-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#966cc537f19dfbd443e768a99dec1f23">shortName</a>;
<a name="l01158"></a>01158     item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a> = newItem-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#3963aef130f2f7c9a94fa5d8a87b48f2">argInfo</a>;
<a name="l01159"></a>01159     item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a> = newItem-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#6915698448ea2e263ad0cf0756d8df65">arg</a>;
<a name="l01160"></a>01160     item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#a6a9c91f5c1869870c3b872395e2b625">val</a> = newItem-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#a6a9c91f5c1869870c3b872395e2b625">val</a>;
<a name="l01161"></a>01161     item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#d0123e0f28a19468eb34e89753064745">descrip</a> =
<a name="l01162"></a>01162         (newItem-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#d0123e0f28a19468eb34e89753064745">descrip</a> ? <a class="code" href="system_8h.html#b62344482c6d93843e0388d2ba2cf514">xstrdup</a>(newItem-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#d0123e0f28a19468eb34e89753064745">descrip</a>) : NULL);
<a name="l01163"></a>01163     item-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#a0eff46a712ca64ea3103be9f73f4373">argDescrip</a> =
<a name="l01164"></a>01164        (newItem-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#a0eff46a712ca64ea3103be9f73f4373">argDescrip</a> ? <a class="code" href="system_8h.html#b62344482c6d93843e0388d2ba2cf514">xstrdup</a>(newItem-&gt;<a class="code" href="structpoptItem__s.html#c9a710583f2c7bd4b8b8bd887bca4611">option</a>.<a class="code" href="structpoptOption.html#a0eff46a712ca64ea3103be9f73f4373">argDescrip</a>) : NULL);
<a name="l01165"></a>01165     item-&gt;<a class="code" href="structpoptItem__s.html#d96c5ac77deda4c55124f3691b2988a4">argc</a> = newItem-&gt;<a class="code" href="structpoptItem__s.html#d96c5ac77deda4c55124f3691b2988a4">argc</a>;
<a name="l01166"></a>01166     item-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a> = newItem-&gt;<a class="code" href="structpoptItem__s.html#0664e04564284789193653f40bd66a34">argv</a>;
<a name="l01167"></a>01167 
<a name="l01168"></a>01168     (*nitems)++;
<a name="l01169"></a>01169 
<a name="l01170"></a>01170     <span class="keywordflow">return</span> 0;
<a name="l01171"></a>01171 }
<a name="l01172"></a>01172 
<a name="l01173"></a><a class="code" href="popt_8h.html#6596aa76645566f0892a1fc7b259a1ef">01173</a> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="popt_8c.html#6596aa76645566f0892a1fc7b259a1ef" title="Return the option which caused the most recent error.">poptBadOption</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flags)
<a name="l01174"></a>01174 {
<a name="l01175"></a>01175     <span class="keyword">struct </span><a class="code" href="structoptionStackEntry.html">optionStackEntry</a> * os = NULL;
<a name="l01176"></a>01176 
<a name="l01177"></a>01177     <span class="keywordflow">if</span> (con != NULL)
<a name="l01178"></a>01178         os = (flags &amp; <a class="code" href="popt_8h.html#6ed58d6f19a41160f386c4c274ea330d">POPT_BADOPTION_NOALIAS</a>) ? con-&gt;<a class="code" href="structpoptContext__s.html#fb4fe00e407510f15c15de9bcdcc9a03">optionStack</a> : con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>;
<a name="l01179"></a>01179 
<a name="l01180"></a>01180     return (os != NULL &amp;&amp; os-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a> != NULL ? os-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>[os-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a> - 1] : NULL);
<a name="l01181"></a>01181 }
<a name="l01182"></a>01182 
<a name="l01183"></a><a class="code" href="popt_8h.html#70ba45398c4222fe2a599331636b31d5">01183</a> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="popt_8c.html#70ba45398c4222fe2a599331636b31d5" title="Return formatted error string for popt failure.">poptStrerror</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> error)
<a name="l01184"></a>01184 {
<a name="l01185"></a>01185     <span class="keywordflow">switch</span> (error) {
<a name="l01186"></a>01186       <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#28bb1cf1823622c3510d2976da33ad06">POPT_ERROR_NOARG</a>:
<a name="l01187"></a>01187         <span class="keywordflow">return</span> <a class="code" href="poptint_8h.html#0c20a067634485b9c68ad5dfe83729d2">POPT_</a>(<span class="stringliteral">"missing argument"</span>);
<a name="l01188"></a>01188       <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#1cbcee08db205a37789f81ec02234def">POPT_ERROR_BADOPT</a>:
<a name="l01189"></a>01189         <span class="keywordflow">return</span> <a class="code" href="poptint_8h.html#0c20a067634485b9c68ad5dfe83729d2">POPT_</a>(<span class="stringliteral">"unknown option"</span>);
<a name="l01190"></a>01190       <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#7075a89582a670d9ea2a1c16e3412faf">POPT_ERROR_BADOPERATION</a>:
<a name="l01191"></a>01191         <span class="keywordflow">return</span> <a class="code" href="poptint_8h.html#0c20a067634485b9c68ad5dfe83729d2">POPT_</a>(<span class="stringliteral">"mutually exclusive logical operations requested"</span>);
<a name="l01192"></a>01192       <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#cb3028810d0b6fcc1b86425a09b1805b">POPT_ERROR_NULLARG</a>:
<a name="l01193"></a>01193         <span class="keywordflow">return</span> <a class="code" href="poptint_8h.html#0c20a067634485b9c68ad5dfe83729d2">POPT_</a>(<span class="stringliteral">"opt-&gt;arg should not be NULL"</span>);
<a name="l01194"></a>01194       <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#1502ab9ab9bffdd60f96a40aabcefb8b">POPT_ERROR_OPTSTOODEEP</a>:
<a name="l01195"></a>01195         <span class="keywordflow">return</span> <a class="code" href="poptint_8h.html#0c20a067634485b9c68ad5dfe83729d2">POPT_</a>(<span class="stringliteral">"aliases nested too deeply"</span>);
<a name="l01196"></a>01196       <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#46d04684e0c20a8a32c1d9d01995de90">POPT_ERROR_BADQUOTE</a>:
<a name="l01197"></a>01197         <span class="keywordflow">return</span> <a class="code" href="poptint_8h.html#0c20a067634485b9c68ad5dfe83729d2">POPT_</a>(<span class="stringliteral">"error in parameter quoting"</span>);
<a name="l01198"></a>01198       <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#ef2d07c24d3a76d6dda5725be37b53c6">POPT_ERROR_BADNUMBER</a>:
<a name="l01199"></a>01199         <span class="keywordflow">return</span> <a class="code" href="poptint_8h.html#0c20a067634485b9c68ad5dfe83729d2">POPT_</a>(<span class="stringliteral">"invalid numeric value"</span>);
<a name="l01200"></a>01200       <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#0627349bf2956429e33e4f45e475b255">POPT_ERROR_OVERFLOW</a>:
<a name="l01201"></a>01201         <span class="keywordflow">return</span> <a class="code" href="poptint_8h.html#0c20a067634485b9c68ad5dfe83729d2">POPT_</a>(<span class="stringliteral">"number too large or too small"</span>);
<a name="l01202"></a>01202       <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#94b752bdfe50201136ceb0402fd93599">POPT_ERROR_MALLOC</a>:
<a name="l01203"></a>01203         <span class="keywordflow">return</span> <a class="code" href="poptint_8h.html#0c20a067634485b9c68ad5dfe83729d2">POPT_</a>(<span class="stringliteral">"memory allocation failed"</span>);
<a name="l01204"></a>01204       <span class="keywordflow">case</span> <a class="code" href="popt_8h.html#94d19f2335b8a6d1b0862edcd4823b3d">POPT_ERROR_ERRNO</a>:
<a name="l01205"></a>01205         <span class="keywordflow">return</span> <a class="code" href="popt_8c.html#191b9c878b2a9c6e615ee10082053737">strerror</a>(errno);
<a name="l01206"></a>01206       <span class="keywordflow">default</span>:
<a name="l01207"></a>01207         <span class="keywordflow">return</span> <a class="code" href="poptint_8h.html#0c20a067634485b9c68ad5dfe83729d2">POPT_</a>(<span class="stringliteral">"unknown error"</span>);
<a name="l01208"></a>01208     }
<a name="l01209"></a>01209 }
<a name="l01210"></a>01210 
<a name="l01211"></a><a class="code" href="popt_8h.html#2e93feadc17ce658d7468285a65eef70">01211</a> <span class="keywordtype">int</span> <a class="code" href="popt_8c.html#2e93feadc17ce658d7468285a65eef70" title="Add arguments to context.">poptStuffArgs</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con, <span class="keyword">const</span> <span class="keywordtype">char</span> ** <a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>)
<a name="l01212"></a>01212 {
<a name="l01213"></a>01213     <span class="keywordtype">int</span> <a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a>;
<a name="l01214"></a>01214     <span class="keywordtype">int</span> rc;
<a name="l01215"></a>01215 
<a name="l01216"></a>01216     <span class="keywordflow">if</span> ((con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a> - con-&gt;<a class="code" href="structpoptContext__s.html#fb4fe00e407510f15c15de9bcdcc9a03">optionStack</a>) == <a class="code" href="popt_8h.html#a50bd81d1fa1d17100540e00b5f7acfd">POPT_OPTION_DEPTH</a>)
<a name="l01217"></a>01217         <span class="keywordflow">return</span> <a class="code" href="popt_8h.html#1502ab9ab9bffdd60f96a40aabcefb8b">POPT_ERROR_OPTSTOODEEP</a>;
<a name="l01218"></a>01218 
<a name="l01219"></a>01219     <span class="keywordflow">for</span> (argc = 0; argv[argc]; argc++)
<a name="l01220"></a>01220         {};
<a name="l01221"></a>01221 
<a name="l01222"></a>01222     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>++;
<a name="l01223"></a>01223     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bfe5c6a29f094c148cff402fba93268e">next</a> = 0;
<a name="l01224"></a>01224     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#133a9f19621c02c59937386181926de9">nextArg</a> = NULL;
<a name="l01225"></a>01225     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#b0485d4d1b9e5c1f9dd8ca4c0fda3478">nextCharArg</a> = NULL;
<a name="l01226"></a>01226     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#358da17455ddd94a5acd74b0559aa8a5">currAlias</a> = NULL;
<a name="l01227"></a>01227     rc = <a class="code" href="popt_8h.html#5fcba044ce909a898284af1c0e38fd3b" title="Duplicate an argument array.">poptDupArgv</a>(argc, argv, &amp;con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a>, &amp;con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>);
<a name="l01228"></a>01228     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#cb18bf9c40375399d0fdce906265b514">argb</a> = NULL;
<a name="l01229"></a>01229     con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#585e45e37b8f7a899434b0f94bd009b7">stuffed</a> = 1;
<a name="l01230"></a>01230 
<a name="l01231"></a>01231     <span class="keywordflow">return</span> rc;
<a name="l01232"></a>01232 }
<a name="l01233"></a>01233 
<a name="l01234"></a><a class="code" href="popt_8h.html#3435666d94b36e7093dfad0edf296954">01234</a> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="popt_8c.html#3435666d94b36e7093dfad0edf296954" title="Return argv[0] from context.">poptGetInvocationName</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con)
<a name="l01235"></a>01235 {
<a name="l01236"></a>01236     <span class="keywordflow">return</span> (con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a> ? con-&gt;<a class="code" href="structpoptContext__s.html#5cdc6e58403772122b3cfe4a0dcae0d2">os</a>-&gt;<a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>[0] : <span class="stringliteral">""</span>);
<a name="l01237"></a>01237 }
<a name="l01238"></a>01238 
<a name="l01239"></a><a class="code" href="popt_8h.html#4ba7b7dddd0a2e3ac21a8b71c9c5115b">01239</a> <span class="keywordtype">int</span> <a class="code" href="popt_8c.html#4ba7b7dddd0a2e3ac21a8b71c9c5115b" title="Shuffle argv pointers to remove stripped args, returns new argc.">poptStrippedArgv</a>(<a class="code" href="structpoptContext__s.html">poptContext</a> con, <span class="keywordtype">int</span> <a class="code" href="structoptionStackEntry.html#bbdb0c53cd6fe3f9dd981f0176d6b76a">argc</a>, <span class="keywordtype">char</span> ** <a class="code" href="structoptionStackEntry.html#ea9844e231fe3e3ae586033bd8bd9e4d">argv</a>)
<a name="l01240"></a>01240 {
<a name="l01241"></a>01241     <span class="keywordtype">int</span> numargs = argc;
<a name="l01242"></a>01242     <span class="keywordtype">int</span> j = 1;
<a name="l01243"></a>01243     <span class="keywordtype">int</span> i;
<a name="l01244"></a>01244     
<a name="l01245"></a>01245 <span class="comment">/*@-sizeoftype@*/</span>
<a name="l01246"></a>01246     <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#6b8f9e4e2175d16b8903243819318418">arg_strip</a>)
<a name="l01247"></a>01247     <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++) {
<a name="l01248"></a>01248         <span class="keywordflow">if</span> (<a class="code" href="poptint_8h.html#8606b44323c6450c9efe9ca1fb6b07c6">PBM_ISSET</a>(i, con-&gt;<a class="code" href="structpoptContext__s.html#6b8f9e4e2175d16b8903243819318418">arg_strip</a>))
<a name="l01249"></a>01249             numargs--;
<a name="l01250"></a>01250     }
<a name="l01251"></a>01251     
<a name="l01252"></a>01252     <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++) {
<a name="l01253"></a>01253         <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structpoptContext__s.html#6b8f9e4e2175d16b8903243819318418">arg_strip</a> &amp;&amp; <a class="code" href="poptint_8h.html#8606b44323c6450c9efe9ca1fb6b07c6">PBM_ISSET</a>(i, con-&gt;<a class="code" href="structpoptContext__s.html#6b8f9e4e2175d16b8903243819318418">arg_strip</a>))
<a name="l01254"></a>01254             <span class="keywordflow">continue</span>;
<a name="l01255"></a>01255         argv[j] = (j &lt; numargs) ? argv[i] : NULL;
<a name="l01256"></a>01256         j++;
<a name="l01257"></a>01257     }
<a name="l01258"></a>01258 <span class="comment">/*@=sizeoftype@*/</span>
<a name="l01259"></a>01259     
<a name="l01260"></a>01260     <span class="keywordflow">return</span> numargs;
<a name="l01261"></a>01261 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated for popt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
