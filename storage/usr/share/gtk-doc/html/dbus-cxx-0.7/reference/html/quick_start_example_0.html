<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>dbus-cxx: Quick start example 0: A simple server and client</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link REL="SHORTCUT ICON" HREF="favicon.ico">
</head><body>
<center><a href="http://dbus-cxx.sourceforge.net"><img src="dbus-cxx-logo-med.png" alt="dbus-cxx logo" border="0"/></a></center>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="quick_start_example_0">Quick start example 0: A simple server and client </a></h1><dl class="user"><dt><b></b></dt><dd>This example will demonstrate a simple server and client pair.</dd></dl>
<dl class="user"><dt><b></b></dt><dd>The server will only offer one method named <code>add</code> that will take two <code>double</code> parameters and return the sum as a <code>double</code>.</dd></dl>
<dl class="user"><dt><b></b></dt><dd>The client will use a proxy object for the server as well as a proxy for the <code>add</code> method.</dd></dl>
<h2><a class="anchor" id="quick_start_server_0">
A simple server</a></h2>
<dl class="user"><dt><b></b></dt><dd>This section provides an example of a simple server. The server will run for 10 seconds and then automatically shut-down.</dd></dl>
<dl class="user"><dt><b>Summary</b></dt><dd>This is an overview of the code we will need in our example server:<ol type="1">
<li>Include headers</li>
<li>Initialize the dbus-cxx library</li>
<li>Create a dispatcher to manage threads, timeouts and I/O watches</li>
<li>Create a connection to the D-Bus session bus</li>
<li>Request a name for our application on the bus</li>
<li>Create an object on the bus</li>
<li>Add a method named <code>add</code> to our object</li>
<li>Wait for incoming calls</li>
</ol>
</dd></dl>
<h2><a class="anchor" id="quick_start_server_0_code">
Simple server 0 code</a></h2>
<dl class="user"><dt><b></b></dt><dd>Here is the code in full, followed by a section-by-section discussion.</dd></dl>
<div class="fragment"><pre class="fragment"><span class="comment">/***************************************************************************</span>
<span class="comment"> *   Copyright (C) 2007,2010 by Rick L. Vinyard, Jr.                       *</span>
<span class="comment"> *   rvinyard@cs.nmsu.edu                                                  *</span>
<span class="comment"> *                                                                         *</span>
<span class="comment"> *   This file is part of the dbus-cxx library.                            *</span>
<span class="comment"> *                                                                         *</span>
<span class="comment"> *   The dbus-cxx library is free software; you can redistribute it and/or *</span>
<span class="comment"> *   modify it under the terms of the GNU General Public License           *</span>
<span class="comment"> *   version 3 as published by the Free Software Foundation.               *</span>
<span class="comment"> *                                                                         *</span>
<span class="comment"> *   The dbus-cxx library is distributed in the hope that it will be       *</span>
<span class="comment"> *   useful, but WITHOUT ANY WARRANTY; without even the implied warranty   *</span>
<span class="comment"> *   of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU   *</span>
<span class="comment"> *   General Public License for more details.                              *</span>
<span class="comment"> *                                                                         *</span>
<span class="comment"> *   You should have received a copy of the GNU General Public License     *</span>
<span class="comment"> *   along with this software. If not see &lt;http://www.gnu.org/licenses/&gt;.  *</span>
<span class="comment"> ***************************************************************************/</span>
<span class="preprocessor">#include &lt;dbus-cxx.h&gt;</span>

<span class="keywordtype">double</span> add( <span class="keywordtype">double</span> param1, <span class="keywordtype">double</span> param2 )      { <span class="keywordflow">return</span> param1 + param2; }

<span class="keywordtype">int</span> main()
{
  <span class="keywordtype">int</span> ret;

  <a class="code" href="namespaceDBus.html#a9019cc1700ee2373fd5ac20af51017a4" title="Initializes the dbus-cxx library.">DBus::init</a>();
  
  <a class="code" href="classDBus_1_1Dispatcher.html#a7adc389576f3012d7c5e2e771101951f">DBus::Dispatcher::pointer</a> dispatcher = <a class="code" href="classDBus_1_1Dispatcher.html#a760bc96682848aac9bd94f383b4aa182">DBus::Dispatcher::create</a>();

  <a class="code" href="classDBus_1_1Connection.html#a36f658da5f2908b9c2f467cea59fc9fa">DBus::Connection::pointer</a> conn = dispatcher-&gt;create_connection(<a class="code" href="namespaceDBus.html#a65a7f3cf99252b69858cd12817d2b764a01dfb747d94c7007edd03aea275bc4c4" title="The login session bus.">DBus::BUS_SESSION</a>);
  
  ret = conn-&gt;request_name( <span class="stringliteral">&quot;dbuscxx.quickstart_0.server&quot;</span>, DBUS_NAME_FLAG_REPLACE_EXISTING );
  <span class="keywordflow">if</span> (DBUS_REQUEST_NAME_REPLY_PRIMARY_OWNER != ret) <span class="keywordflow">return</span> 1;

  <a class="code" href="classDBus_1_1Object.html#a5bf674b9935ccede5a0cc5c9e5edfbc4" title="Typedef to smart pointers to Object.">DBus::Object::pointer</a> <span class="keywordtype">object</span> = conn-&gt;create_object(<span class="stringliteral">&quot;/dbuscxx/quickstart_0&quot;</span>);

  <span class="keywordtype">object</span>-&gt;create_method&lt;double,double,<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;dbuscxx.Quickstart&quot;</span>, <span class="stringliteral">&quot;add&quot;</span>, sigc::ptr_fun(add) );

  sleep(10);
  
  <span class="keywordflow">return</span> 0;
}
</pre></div><h2><a class="anchor" id="quick_start_server_0_discussion">
Simple server 0 code discussion</a></h2>
<dl class="user"><dt><b>Include headers</b></dt><dd>First, we need to include the main dbus-cxx library header: <div class="fragment"><pre class="fragment"><span class="preprocessor"> #include &lt;dbus-cxx.h&gt;</span>
</pre></div></dd></dl>
<dl class="user"><dt><b></b></dt><dd>Then we will define a function that will be our workhorse on the server side. This function will be the actual function that will be called when the dbus <code>add</code> method is invoked, so we will name our function similarly. But, note that the actual name of the function in our program and the name in our dbus server do not have to match. <div class="fragment"><pre class="fragment"> <span class="keywordtype">double</span> add( <span class="keywordtype">double</span> param1, <span class="keywordtype">double</span> param2 )      { <span class="keywordflow">return</span> param1 + param2; } 
</pre></div></dd></dl>
<dl class="user"><dt><b></b></dt><dd>And now for the beginning of our <code>main()</code> function. We'll also declare a variable <code>ret</code> that can be used to check the return value of functions. <div class="fragment"><pre class="fragment"> <span class="keywordtype">int</span> main()
 {
   <span class="keywordtype">int</span> ret;
</pre></div></dd></dl>
<dl class="user"><dt><b>Initialize the dbus-cxx library</b></dt><dd>Before we do anything in dbus-cxx we must call the library's <code><a class="el" href="namespaceDBus.html#a9019cc1700ee2373fd5ac20af51017a4" title="Initializes the dbus-cxx library.">init()</a></code> method which will take care of various initializations including the threading system. <div class="fragment"><pre class="fragment"> <a class="code" href="namespaceDBus.html#a9019cc1700ee2373fd5ac20af51017a4" title="Initializes the dbus-cxx library.">DBus::init</a>(); 
</pre></div></dd></dl>
<dl class="user"><dt><b>Create a dispatcher to manage threads, timeouts and I/O watches</b></dt><dd>Now, we will create a dispatcher to handle incoming and outgoing messages. Handling incoming and outgoing messages can be messy and the Dispatcher class handles much of this for us. <div class="fragment"><pre class="fragment"> <a class="code" href="classDBus_1_1Dispatcher.html#a7adc389576f3012d7c5e2e771101951f">DBus::Dispatcher::pointer</a> dispatcher = <a class="code" href="classDBus_1_1Dispatcher.html#a760bc96682848aac9bd94f383b4aa182">DBus::Dispatcher::create</a>(); 
</pre></div></dd></dl>
<dl class="user"><dt><b>Create a connection to the D-Bus session bus</b></dt><dd>Now that we have a dispatcher we need to create a connection to the session bus. <div class="fragment"><pre class="fragment"> <a class="code" href="classDBus_1_1Connection.html#a36f658da5f2908b9c2f467cea59fc9fa">DBus::Connection::pointer</a> conn = dispatcher-&gt;create_connection(<a class="code" href="namespaceDBus.html#a65a7f3cf99252b69858cd12817d2b764a01dfb747d94c7007edd03aea275bc4c4" title="The login session bus.">DBus::BUS_SESSION</a>); 
</pre></div></dd></dl>
<dl class="user"><dt><b>Request a name for our application on the bus</b></dt><dd>Next, we need to request a name that will identify our application on the session bus. <div class="fragment"><pre class="fragment">   ret = conn-&gt;request_name( <span class="stringliteral">&quot;dbuscxx.quickstart_0.server&quot;</span>, DBUS_NAME_FLAG_REPLACE_EXISTING );
   <span class="keywordflow">if</span> (DBUS_REQUEST_NAME_REPLY_PRIMARY_OWNER != ret) <span class="keywordflow">return</span> 1;
</pre></div></dd></dl>
<dl class="user"><dt><b>Create an object on the bus</b></dt><dd>Now that our application has a name on the bus we need to add an object with it's path. <div class="fragment"><pre class="fragment"> <a class="code" href="classDBus_1_1Object.html#a5bf674b9935ccede5a0cc5c9e5edfbc4" title="Typedef to smart pointers to Object.">DBus::Object::pointer</a> <span class="keywordtype">object</span> = conn-&gt;create_object(<span class="stringliteral">&quot;/dbuscxx/quickstart_0&quot;</span>); 
</pre></div></dd></dl>
<dl class="user"><dt><b>Add a method named <code>add</code> to our object</b></dt><dd>We will now create a method named <code>add</code> for our object. The functionality of the method will be provided by the function we declared above also named <code>add()</code>. We must add this to an interface, and the D-Bus specification required that interface names must contain at least one <b></b>. (period) character so we will use the interface name <code>"dbuscxx.Quickstart"</code>.</dd></dl>
<dl class="user"><dt><b></b></dt><dd>Note that our object's method named <code>add</code> has nothing to do with C++ class methods. In essence we are creating virtual objects on the D-Bus and can choose to provide their functionality with either C++ class methods and/or plain functions. <div class="fragment"><pre class="fragment"> <span class="keywordtype">object</span>-&gt;create_method&lt;double,double,<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;dbuscxx.Quickstart&quot;</span>, <span class="stringliteral">&quot;add&quot;</span>, sigc::ptr_fun(add) ); 
</pre></div></dd></dl>
<dl class="user"><dt><b>Wait for incoming calls</b></dt><dd>Finally, we need to wait for incoming calls. We will sleep for 10 seconds in our <code>main()</code> function and the calls will be handled in the dispatcher's threads. <div class="fragment"><pre class="fragment"> sleep(10);
   
   <span class="keywordflow">return</span> 0;
 }
</pre></div></dd></dl>
<p><b>Continue On:</b> <a class="el" href="quick_start_client_0.html">Quick Start Client 0</a></p>
<p><b>Go Back:</b> <a class="el" href="quick_start.html">Quick Start Guide to dbus-cxx</a> </p>
</div>
<hr size="1"><address style="align: right;"><small>
Generated on Thu Mar 18 09:31:29 2010 for dbus-cxx by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.6.1</small></address>
</body>
</html>
