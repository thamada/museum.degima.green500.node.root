<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>dbus-cxx: Quick Start Client 0</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link REL="SHORTCUT ICON" HREF="favicon.ico">
</head><body>
<center><a href="http://dbus-cxx.sourceforge.net"><img src="dbus-cxx-logo-med.png" alt="dbus-cxx logo" border="0"/></a></center>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="quick_start_client_0">Quick Start Client 0 </a></h1><h2><a class="anchor" id="quick_start_server_0">
A simple server</a></h2>
<dl class="user"><dt><b></b></dt><dd>This section provides an example of a simple client for our simple server.</dd></dl>
<dl class="user"><dt><b>Summary</b></dt><dd>This is an overview of the code we will need in our example client:<ol type="1">
<li>Include headers</li>
<li>Initialize the dbus-cxx library</li>
<li>Create a dispatcher to manage threads, timeouts and I/O watches</li>
<li>Create a connection to the D-Bus session bus</li>
<li>Create a proxy object for the server's <code>quickstart_0</code> object</li>
<li>Create a proxy <code>add</code> method for our proxy object</li>
<li>Call our proxy method</li>
<li>Print out the results</li>
</ol>
</dd></dl>
<h2><a class="anchor" id="quick_start_client_0_code">
Simple client 0 code</a></h2>
<dl class="user"><dt><b></b></dt><dd>Here is the code in full, followed by a section-by-section discussion.</dd></dl>
<div class="fragment"><pre class="fragment"><span class="comment">/***************************************************************************</span>
<span class="comment"> *   Copyright (C) 2007,2010 by Rick L. Vinyard, Jr.                       *</span>
<span class="comment"> *   rvinyard@cs.nmsu.edu                                                  *</span>
<span class="comment"> *                                                                         *</span>
<span class="comment"> *   This file is part of the dbus-cxx library.                            *</span>
<span class="comment"> *                                                                         *</span>
<span class="comment"> *   The dbus-cxx library is free software; you can redistribute it and/or *</span>
<span class="comment"> *   modify it under the terms of the GNU General Public License           *</span>
<span class="comment"> *   version 3 as published by the Free Software Foundation.               *</span>
<span class="comment"> *                                                                         *</span>
<span class="comment"> *   The dbus-cxx library is distributed in the hope that it will be       *</span>
<span class="comment"> *   useful, but WITHOUT ANY WARRANTY; without even the implied warranty   *</span>
<span class="comment"> *   of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU   *</span>
<span class="comment"> *   General Public License for more details.                              *</span>
<span class="comment"> *                                                                         *</span>
<span class="comment"> *   You should have received a copy of the GNU General Public License     *</span>
<span class="comment"> *   along with this software. If not see &lt;http://www.gnu.org/licenses/&gt;.  *</span>
<span class="comment"> ***************************************************************************/</span>
<span class="preprocessor">#include &lt;dbus-cxx.h&gt;</span>
<span class="preprocessor">#include &lt;iostream&gt;</span>

<span class="keywordtype">int</span> main()
{
  <a class="code" href="namespaceDBus.html#a9019cc1700ee2373fd5ac20af51017a4" title="Initializes the dbus-cxx library.">DBus::init</a>();

  <a class="code" href="classDBus_1_1Dispatcher.html#a7adc389576f3012d7c5e2e771101951f">DBus::Dispatcher::pointer</a> dispatcher;
  dispatcher = <a class="code" href="classDBus_1_1Dispatcher.html#a760bc96682848aac9bd94f383b4aa182">DBus::Dispatcher::create</a>();

  <a class="code" href="classDBus_1_1Connection.html#a36f658da5f2908b9c2f467cea59fc9fa">DBus::Connection::pointer</a> connection;
  connection = dispatcher-&gt;create_connection( <a class="code" href="namespaceDBus.html#a65a7f3cf99252b69858cd12817d2b764a01dfb747d94c7007edd03aea275bc4c4" title="The login session bus.">DBus::BUS_SESSION</a> );

  <a class="code" href="classDBus_1_1ObjectProxy.html#a2fbbba782168b49238d491f8a783d043" title="Typedef to smart pointers to ObjectProxy.">DBus::ObjectProxy::pointer</a> object;
  <span class="keywordtype">object</span> = connection-&gt;create_object_proxy(<span class="stringliteral">&quot;dbuscxx.quickstart_0.server&quot;</span>, <span class="stringliteral">&quot;/dbuscxx/quickstart_0&quot;</span>);

  <a class="code" href="classDBus_1_1MethodProxy.html">DBus::MethodProxy&lt;double,double,double&gt;</a>&amp; add_proxy
    = *(<span class="keywordtype">object</span>-&gt;create_method&lt;double,double,<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;dbuscxx.Quickstart&quot;</span>,<span class="stringliteral">&quot;add&quot;</span>));

  <span class="keywordtype">double</span> answer;
  answer = add_proxy( 1.1, 2.2 );

  std::cout &lt;&lt; <span class="stringliteral">&quot;1.1 + 2.2 = &quot;</span> &lt;&lt; answer &lt;&lt; std::endl;

  <span class="keywordflow">return</span> 0;
}
</pre></div><h2><a class="anchor" id="quick_start_client_0_discussion">
Simple client 0 code discussion</a></h2>
<dl class="user"><dt><b>Include headers</b></dt><dd>First, we need to include the main dbus-cxx library header. We'll also include the <code>iostream</code> header since we'll print out the results of our addition. <div class="fragment"><pre class="fragment"><span class="preprocessor"> #include &lt;dbus-cxx.h&gt;</span>
<span class="preprocessor"> #include &lt;iostream&gt;</span>
</pre></div></dd></dl>
<dl class="user"><dt><b></b></dt><dd>And now for the beginning of our <code>main()</code> function. <div class="fragment"><pre class="fragment"> <span class="keywordtype">int</span> main()
 {
</pre></div></dd></dl>
<dl class="user"><dt><b>Initialize the dbus-cxx library</b></dt><dd>Before we do anything in dbus-cxx we must call the library's <code><a class="el" href="namespaceDBus.html#a9019cc1700ee2373fd5ac20af51017a4" title="Initializes the dbus-cxx library.">init()</a></code> method which will take care of various initializations including the threading system. <div class="fragment"><pre class="fragment"> <a class="code" href="namespaceDBus.html#a9019cc1700ee2373fd5ac20af51017a4" title="Initializes the dbus-cxx library.">DBus::init</a>(); 
</pre></div></dd></dl>
<dl class="user"><dt><b>Create a dispatcher to manage threads, timeouts and I/O watches</b></dt><dd>Now, we will create a dispatcher to handle incoming and outgoing messages. Handling incoming and outgoing messages can be messy and the Dispatcher class handles much of this for us. <div class="fragment"><pre class="fragment"> <a class="code" href="classDBus_1_1Dispatcher.html#a7adc389576f3012d7c5e2e771101951f">DBus::Dispatcher::pointer</a> dispatcher = <a class="code" href="classDBus_1_1Dispatcher.html#a760bc96682848aac9bd94f383b4aa182">DBus::Dispatcher::create</a>(); 
</pre></div></dd></dl>
<dl class="user"><dt><b>Create a connection to the D-Bus session bus</b></dt><dd>Now that we have a dispatcher we need to create a connection to the session bus. <div class="fragment"><pre class="fragment"> <a class="code" href="classDBus_1_1Connection.html#a36f658da5f2908b9c2f467cea59fc9fa">DBus::Connection::pointer</a> conn = dispatcher-&gt;create_connection(<a class="code" href="namespaceDBus.html#a65a7f3cf99252b69858cd12817d2b764a01dfb747d94c7007edd03aea275bc4c4" title="The login session bus.">DBus::BUS_SESSION</a>); 
</pre></div></dd></dl>
<dl class="user"><dt><b></b></dt><dd></dd></dl>
<dl class="user"><dt><b>Request a name for our application on the bus</b></dt><dd>Next, we need to request a name that will identify our application on the session bus. <div class="fragment"><pre class="fragment">   ret = conn-&gt;request_name( <span class="stringliteral">&quot;dbuscxx.quickstart_0.server&quot;</span>, DBUS_NAME_FLAG_REPLACE_EXISTING );
   <span class="keywordflow">if</span> (DBUS_REQUEST_NAME_REPLY_PRIMARY_OWNER != ret) <span class="keywordflow">return</span> 1;
</pre></div></dd></dl>
<dl class="user"><dt><b>Create a proxy object for the server's <code>quickstart_0</code> object</b></dt><dd>You'll notice that up to this point the code for the client and the server has been nearly identical. This is the point at which they will diverge. We will now create a proxy object for the object on the server. <div class="fragment"><pre class="fragment">   <a class="code" href="classDBus_1_1ObjectProxy.html#a2fbbba782168b49238d491f8a783d043" title="Typedef to smart pointers to ObjectProxy.">DBus::ObjectProxy::pointer</a> object;
   <span class="keywordtype">object</span> = connection-&gt;create_object_proxy(<span class="stringliteral">&quot;dbuscxx.quickstart_0.server&quot;</span>, <span class="stringliteral">&quot;/dbuscxx/quickstart_0&quot;</span>);
</pre></div> Note that we must use the name the server requested as well as the object path the server used when it created it's object when we create the proxy object.</dd></dl>
<dl class="user"><dt><b>Create a proxy <code>add</code> method for our proxy object</b></dt><dd>Now we create a proxy <code>add</code> method for the server object's <code>add</code> method. This will allow us to use function notation to call the method. When creating the proxy method we must use the same interface (<code>"dbuscxx.Quickstart"</code> ) and method name ( <code>"add"</code> ) as the server used. <div class="fragment"><pre class="fragment">   <a class="code" href="classDBus_1_1MethodProxy.html">DBus::MethodProxy&lt;double,double,double&gt;</a>&amp; add_proxy
     = *(<span class="keywordtype">object</span>-&gt;create_method&lt;double,double,<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;dbuscxx.Quickstart&quot;</span>,<span class="stringliteral">&quot;add&quot;</span>));
</pre></div></dd></dl>
<dl class="user"><dt><b>Call our proxy method</b></dt><dd>Now we can use our proxy method to call the method on the server using function notation. We'll keep things simple and just add <code>1.1</code> <code>+</code> <code>2.2</code> . <div class="fragment"><pre class="fragment">   <span class="keywordtype">double</span> answer;
   answer = add_proxy( 1.1, 2.2 );
</pre></div></dd></dl>
<dl class="user"><dt><b>Print out the results</b></dt><dd>Finally, we can print out the results. <div class="fragment"><pre class="fragment">   std::cout &lt;&lt; <span class="stringliteral">&quot;1.1 + 2.2 = &quot;</span> &lt;&lt; answer &lt;&lt; std::endl;

   <span class="keywordflow">return</span> 0;
 }
</pre></div></dd></dl>
<p><b>Go Back:</b> <a class="el" href="quick_start.html">Quick Start Guide to dbus-cxx</a> </p>
</div>
<hr size="1"><address style="align: right;"><small>
Generated on Thu Mar 18 09:31:29 2010 for dbus-cxx by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.6.1</small></address>
</body>
</html>
