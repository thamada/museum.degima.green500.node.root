---
 drivers/infiniband/ulp/sdp/sdp_main.c |   12 ++----------
 1 file changed, 2 insertions(+), 10 deletions(-)

Index: ofed_kernel-2.6.9_U7/drivers/infiniband/ulp/sdp/sdp_main.c
===================================================================
--- ofed_kernel-2.6.9_U7.orig/drivers/infiniband/ulp/sdp/sdp_main.c	2010-11-04 11:26:40.000000000 +0200
+++ ofed_kernel-2.6.9_U7/drivers/infiniband/ulp/sdp/sdp_main.c	2010-11-04 11:28:12.000000000 +0200
@@ -539,7 +539,6 @@
 	}
 
 	sdp_add_to_history(sk, __func__);
-	atomic_dec(sk->sk_prot->orphan_count);
 	atomic_dec(sk->sk_prot->sockets_allocated);
 	ssk->destructed_already = 1;
 
@@ -2706,7 +2705,6 @@
 
 static atomic_t sockets_allocated;
 static atomic_t memory_allocated;
-static atomic_t orphan_count;
 static int memory_pressure;
 struct proto sdp_proto = {
         .close       = sdp_close,
@@ -2727,13 +2725,11 @@
 	.sockets_allocated = &sockets_allocated,
 	.memory_allocated = &memory_allocated,
 	.memory_pressure = &memory_pressure,
-	.orphan_count = &orphan_count,
         .sysctl_mem             = sysctl_tcp_mem,
         .sysctl_wmem            = sysctl_tcp_wmem,
         .sysctl_rmem            = sysctl_tcp_rmem,
-	.max_header  = sizeof(struct sdp_bsdh),
-        .obj_size    = sizeof(struct sdp_sock),
-	.owner	     = THIS_MODULE,
+	.max_header  		= sizeof(struct sdp_bsdh),
+        .slab_obj_size    	= sizeof(struct sdp_sock),
 	.name	     = "SDP",
 };
 
@@ -2995,10 +2991,6 @@
 	sock_unregister(PF_INET_SDP);
 	proto_unregister(&sdp_proto);
 
-	if (atomic_read(&orphan_count))
-		printk(KERN_WARNING "%s: orphan_count %d\n", __func__,
-				atomic_read(&orphan_count));
-
 	destroy_workqueue(rx_comp_wq);
 	destroy_workqueue(sdp_wq);
 
Index: ofed_kernel-2.6.9_U7/drivers/infiniband/ulp/sdp/sdp.h
===================================================================
--- ofed_kernel-2.6.9_U7.orig/drivers/infiniband/ulp/sdp/sdp.h	2010-11-04 11:26:39.000000000 +0200
+++ ofed_kernel-2.6.9_U7/drivers/infiniband/ulp/sdp/sdp.h	2010-11-04 11:27:46.000000000 +0200
@@ -112,7 +112,6 @@
 		sdp_dbg(sk, "%s:%d - sock_put(SOCK_REF_ALIVE" \
 			") - refcount = %d from withing sk_common_release\n",\
 			__func__, __LINE__, atomic_read(&(sk)->sk_refcnt));\
-		atomic_inc((sk)->sk_prot->orphan_count);\
 		sdp_add_to_history(sk, "sdp_common_release");	\
 		_sdp_add_to_history(sk, "SOCK_REF_ALIVE", __func__, __LINE__, \
 				2, SOCK_REF_ALIVE); \
