---
 drivers/infiniband/hw/ehca/ehca_main.c |   13 +++++--------
 1 file changed, 5 insertions(+), 8 deletions(-)

Index: ofed_kernel/drivers/infiniband/hw/ehca/ehca_main.c
===================================================================
--- ofed_kernel.orig/drivers/infiniband/hw/ehca/ehca_main.c
+++ ofed_kernel/drivers/infiniband/hw/ehca/ehca_main.c
@@ -619,11 +619,6 @@ static struct attribute_group ehca_drv_a
 	.attrs = ehca_drv_attrs
 };
 
-static struct attribute_group *ehca_drv_attr_groups[] = {
-	&ehca_drv_attr_grp,
-	NULL,
-};
-
 #define EHCA_RESOURCE_ATTR(name)                                           \
 static ssize_t  ehca_show_##name(struct device *dev,                       \
 				 struct device_attribute *attr,            \
@@ -930,9 +925,6 @@ static struct of_platform_driver ehca_dr
 	.match_table = ehca_device_table,
 	.probe       = ehca_probe,
 	.remove      = ehca_remove,
-	.driver	     = {
-		.groups = ehca_drv_attr_groups,
-	},
 };
 
 void ehca_poll_eqs(unsigned long data)
@@ -991,6 +983,10 @@ static int __init ehca_module_init(void)
 		goto module_init2;
 	}
 
+	ret = sysfs_create_group(&ehca_driver.driver.kobj, &ehca_drv_attr_grp);
+	if (ret) /* only complain; we can live without attributes */
+		ehca_gen_err("Cannot create driver attributes  ret=%d", ret);
+
 	if (ehca_poll_all_eqs != 1) {
 		ehca_gen_err("WARNING!!!");
 		ehca_gen_err("It is possible to lose interrupts.");
@@ -1016,6 +1012,7 @@ static void __exit ehca_module_exit(void
 	if (ehca_poll_all_eqs == 1)
 		del_timer_sync(&poll_eqs_timer);
 
+	sysfs_remove_group(&ehca_driver.driver.kobj, &ehca_drv_attr_grp);
 	ibmebus_unregister_driver(&ehca_driver);
 
 	ehca_destroy_slab_caches();
