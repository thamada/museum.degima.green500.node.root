From 3c40d790e0a29471bbdc5b1beba34fa6a9a83b59 Mon Sep 17 00:00:00 2001
From: Eli Cohen <eli@mellanox.co.il>
Date: Sun, 22 Aug 2010 15:27:07 +0300
Subject: [PATCH] iboe: adapt implementation to match kernel

Signed-off-by: Eli Cohen <eli@mellanox.co.il>
---
 drivers/infiniband/ulp/ipoib/ipoib_main.c |    6 +-

diff --git a/drivers/infiniband/ulp/ipoib/ipoib_main.c b/drivers/infiniband/ulp/ipoib/ipoib_main.c
index a1fde92..a1ae9f5 100644
--- a/drivers/infiniband/ulp/ipoib/ipoib_main.c
+++ b/drivers/infiniband/ulp/ipoib/ipoib_main.c
@@ -427,7 +427,7 @@ static void path_rec_completion(int status,
 	if (!status) {
 		struct ib_ah_attr av;
 
-		if (!ib_init_ah_from_path(priv->ca, priv->port, pathrec, &av, 0))
+		if (!ib_init_ah_from_path(priv->ca, priv->port, pathrec, &av))
 			ah = ipoib_create_ah(dev, priv->pd, &av);
 	}
 
@@ -1387,7 +1387,7 @@ static void ipoib_add_one(struct ib_device *device)
 	}
 
 	for (p = s; p <= e; ++p) {
-		if (rdma_port_link_layer(device, p) != IB_LINK_LAYER_INFINIBAND)
+		if (rdma_port_get_link_layer(device, p) != IB_LINK_LAYER_INFINIBAND)
 			continue;
 		dev = ipoib_add_port("ib%d", device, p);
 		if (!IS_ERR(dev)) {
@@ -1410,7 +1410,7 @@ static void ipoib_remove_one(struct ib_device *device)
 	dev_list = ib_get_client_data(device, &ipoib_client);
 
 	list_for_each_entry_safe(priv, tmp, dev_list, list) {
-		if (rdma_port_link_layer(device, priv->port) != IB_LINK_LAYER_INFINIBAND)
+		if (rdma_port_get_link_layer(device, priv->port) != IB_LINK_LAYER_INFINIBAND)
 			continue;
 
 		ib_unregister_event_handler(&priv->event_handler);
-- 
1.7.2

